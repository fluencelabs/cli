/* eslint-disable */
// @ts-nocheck
/**
 *
 * This file is auto-generated. Do not edit manually: changes may be erased.
 * Generated by Aqua compiler: https://github.com/fluencelabs/aqua/.
 * If you find any bugs, please write an issue on GitHub: https://github.com/fluencelabs/aqua/issues
 * Aqua version: 0.11.7
 *
 */
import type { IFluenceClient as IFluenceClient$$, CallParams as CallParams$$ } from '@fluencelabs/js-client.api';
import {
    v5_callFunction as callFunction$$,
    v5_registerService as registerService$$,
} from '@fluencelabs/js-client.api';
    


// Services

export interface ScopeDef {
    get_peer_id: (callParams: CallParams$$<null>) => string | Promise<string>;
}
export function registerScope(service: ScopeDef): void;
export function registerScope(serviceId: string, service: ScopeDef): void;
export function registerScope(peer: IFluenceClient$$, service: ScopeDef): void;
export function registerScope(peer: IFluenceClient$$, serviceId: string, service: ScopeDef): void;
       

export function registerScope(...args: any) {
    registerService$$(
        args,
        {
    "defaultServiceId" : "scope",
    "functions" : {
        "tag" : "labeledProduct",
        "fields" : {
            "get_peer_id" : {
                "tag" : "arrow",
                "domain" : {
                    "tag" : "nil"
                },
                "codomain" : {
                    "tag" : "unlabeledProduct",
                    "items" : [
                        {
                            "tag" : "scalar",
                            "name" : "string"
                        }
                    ]
                }
            }
        }
    }
}
    );
}
      


export interface PeerTimeTruncDef {
    timestamp_sec: (callParams: CallParams$$<null>) => number | Promise<number>;
}
export function registerPeerTimeTrunc(service: PeerTimeTruncDef): void;
export function registerPeerTimeTrunc(serviceId: string, service: PeerTimeTruncDef): void;
export function registerPeerTimeTrunc(peer: IFluenceClient$$, service: PeerTimeTruncDef): void;
export function registerPeerTimeTrunc(peer: IFluenceClient$$, serviceId: string, service: PeerTimeTruncDef): void;
       

export function registerPeerTimeTrunc(...args: any) {
    registerService$$(
        args,
        {
    "defaultServiceId" : "peer",
    "functions" : {
        "tag" : "labeledProduct",
        "fields" : {
            "timestamp_sec" : {
                "tag" : "arrow",
                "domain" : {
                    "tag" : "nil"
                },
                "codomain" : {
                    "tag" : "unlabeledProduct",
                    "items" : [
                        {
                            "tag" : "scalar",
                            "name" : "u32"
                        }
                    ]
                }
            }
        }
    }
}
    );
}
      
// Functions
export const deal_install_script = `
                    (xor
                     (seq
                      (seq
                       (seq
                        (seq
                         (seq
                          (seq
                           (call %init_peer_id% ("getDataSrv" "-relay-") [] -relay-)
                           (call %init_peer_id% ("getDataSrv" "ipfs") [] ipfs)
                          )
                          (call %init_peer_id% ("getDataSrv" "worker_def_cid") [] worker_def_cid)
                         )
                         (call %init_peer_id% ("getDataSrv" "deal_id") [] deal_id)
                        )
                        (par
                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["deal_install" "enter"])
                         (null)
                        )
                       )
                       (new $worker_spell
                        (seq
                         (seq
                          (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id)
                          (xor
                           (call %init_peer_id% ("srv" "resolve_alias") ["worker-spell"] $worker_spell)
                           (seq
                            (ap spell_id $worker_spell)
                            (xor
                             (seq
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (call %init_peer_id% ("srv" "add_alias") ["worker-spell" spell_id])
                                   (par
                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                    (null)
                                   )
                                  )
                                  (new $array-inline
                                   (seq
                                    (seq
                                     (ap "alias created 'worker-spell'" $array-inline)
                                     (ap spell_id $array-inline)
                                    )
                                    (canon %init_peer_id% $array-inline  #array-inline-0)
                                   )
                                  )
                                 )
                                 (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-0)
                                )
                                (call %init_peer_id% ("debug" "stringify") [#array-inline-0] str)
                               )
                               (par
                                (call %init_peer_id% (spell_id-0 "list_push_string") ["logs" str])
                                (seq
                                 (new $array-inline-1
                                  (seq
                                   (seq
                                    (ap spell_id-0 $array-inline-1)
                                    (ap #array-inline-0 $array-inline-1)
                                   )
                                   (canon %init_peer_id% $array-inline-1  #array-inline-1-0)
                                  )
                                 )
                                 (call %init_peer_id% ("run-console" "print") [#array-inline-1-0])
                                )
                               )
                              )
                              (par
                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                               (null)
                              )
                             )
                             (seq
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (par
                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                   (null)
                                  )
                                  (new $array-inline-2
                                   (seq
                                    (seq
                                     (ap "error creating alias" $array-inline-2)
                                     (ap %last_error% $array-inline-2)
                                    )
                                    (canon %init_peer_id% $array-inline-2  #array-inline-2-0)
                                   )
                                  )
                                 )
                                 (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-1)
                                )
                                (call %init_peer_id% ("debug" "stringify") [#array-inline-2-0] str-0)
                               )
                               (par
                                (call %init_peer_id% (spell_id-1 "list_push_string") ["logs" str-0])
                                (seq
                                 (new $array-inline-3
                                  (seq
                                   (seq
                                    (ap spell_id-1 $array-inline-3)
                                    (ap #array-inline-2-0 $array-inline-3)
                                   )
                                   (canon %init_peer_id% $array-inline-3  #array-inline-3-0)
                                  )
                                 )
                                 (call %init_peer_id% ("run-console" "print") [#array-inline-3-0])
                                )
                               )
                              )
                              (par
                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                               (null)
                              )
                             )
                            )
                           )
                          )
                         )
                         (xor
                          (seq
                           (new $worker_spell_test
                            (seq
                             (seq
                              (seq
                               (call %init_peer_id% ("math" "add") [0 1] worker_spell_incr)
                               (fold $worker_spell worker_spell_fold_var
                                (seq
                                 (seq
                                  (ap worker_spell_fold_var $worker_spell_test)
                                  (canon %init_peer_id% $worker_spell_test  #worker_spell_iter_canon)
                                 )
                                 (xor
                                  (match #worker_spell_iter_canon.length worker_spell_incr
                                   (null)
                                  )
                                  (next worker_spell_fold_var)
                                 )
                                )
                                (never)
                               )
                              )
                              (canon %init_peer_id% $worker_spell_test  #worker_spell_result_canon)
                             )
                             (ap #worker_spell_result_canon worker_spell_gate)
                            )
                           )
                           (mismatch worker_spell_gate.$.[0] spell_id
                            (xor
                             (seq
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (par
                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                   (null)
                                  )
                                  (new $array-inline-4
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (new $worker_spell_test-0
                                        (seq
                                         (seq
                                          (seq
                                           (call %init_peer_id% ("math" "add") [0 1] worker_spell_incr-0)
                                           (fold $worker_spell worker_spell_fold_var-0
                                            (seq
                                             (seq
                                              (ap worker_spell_fold_var-0 $worker_spell_test-0)
                                              (canon %init_peer_id% $worker_spell_test-0  #worker_spell_iter_canon-0)
                                             )
                                             (xor
                                              (match #worker_spell_iter_canon-0.length worker_spell_incr-0
                                               (null)
                                              )
                                              (next worker_spell_fold_var-0)
                                             )
                                            )
                                            (never)
                                           )
                                          )
                                          (canon %init_peer_id% $worker_spell_test-0  #worker_spell_result_canon-0)
                                         )
                                         (ap #worker_spell_result_canon-0 worker_spell_gate-0)
                                        )
                                       )
                                       (ap "Another worker spell is deployed on this worker (existing, current)" $array-inline-4)
                                      )
                                      (ap worker_spell_gate-0.$.[0] $array-inline-4)
                                     )
                                     (ap spell_id $array-inline-4)
                                    )
                                    (canon %init_peer_id% $array-inline-4  #array-inline-4-0)
                                   )
                                  )
                                 )
                                 (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-2)
                                )
                                (call %init_peer_id% ("debug" "stringify") [#array-inline-4-0] str-1)
                               )
                               (par
                                (call %init_peer_id% (spell_id-2 "list_push_string") ["logs" str-1])
                                (seq
                                 (new $array-inline-5
                                  (seq
                                   (seq
                                    (ap spell_id-2 $array-inline-5)
                                    (ap #array-inline-4-0 $array-inline-5)
                                   )
                                   (canon %init_peer_id% $array-inline-5  #array-inline-5-0)
                                  )
                                 )
                                 (call %init_peer_id% ("run-console" "print") [#array-inline-5-0])
                                )
                               )
                              )
                              (par
                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                               (null)
                              )
                             )
                             (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 1])
                            )
                           )
                          )
                          (seq
                           (seq
                            (seq
                             (seq
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (par
                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                           (null)
                                          )
                                          (new $array-inline-6
                                           (seq
                                            (seq
                                             (ap "Installing worker for deal" $array-inline-6)
                                             (ap deal_id $array-inline-6)
                                            )
                                            (canon %init_peer_id% $array-inline-6  #array-inline-6-0)
                                           )
                                          )
                                         )
                                         (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-3)
                                        )
                                        (call %init_peer_id% ("debug" "stringify") [#array-inline-6-0] str-2)
                                       )
                                       (par
                                        (call %init_peer_id% (spell_id-3 "list_push_string") ["logs" str-2])
                                        (seq
                                         (new $array-inline-7
                                          (seq
                                           (seq
                                            (ap spell_id-3 $array-inline-7)
                                            (ap #array-inline-6-0 $array-inline-7)
                                           )
                                           (canon %init_peer_id% $array-inline-7  #array-inline-7-0)
                                          )
                                         )
                                         (call %init_peer_id% ("run-console" "print") [#array-inline-7-0])
                                        )
                                       )
                                      )
                                      (par
                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                       (null)
                                      )
                                     )
                                     (par
                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["install" "enter"])
                                      (null)
                                     )
                                    )
                                    (xor
                                     (seq
                                      (call %init_peer_id% ("aqua-ipfs" "cat_from") [worker_def_cid ipfs] json)
                                      (xor
                                       (match json.$.success true
                                        (xor
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (call %init_peer_id% ("json" "parse") [json.$.contents] worker_definition)
                                                       (par
                                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                        (null)
                                                       )
                                                      )
                                                      (new $array-inline-8
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (ap "parsed worker definition" $array-inline-8)
                                                          (ap worker_def_cid $array-inline-8)
                                                         )
                                                         (ap worker_definition $array-inline-8)
                                                        )
                                                        (canon %init_peer_id% $array-inline-8  #array-inline-8-0)
                                                       )
                                                      )
                                                     )
                                                     (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-4)
                                                    )
                                                    (call %init_peer_id% ("debug" "stringify") [#array-inline-8-0] str-3)
                                                   )
                                                   (par
                                                    (call %init_peer_id% (spell_id-4 "list_push_string") ["logs" str-3])
                                                    (seq
                                                     (new $array-inline-9
                                                      (seq
                                                       (seq
                                                        (ap spell_id-4 $array-inline-9)
                                                        (ap #array-inline-8-0 $array-inline-9)
                                                       )
                                                       (canon %init_peer_id% $array-inline-9  #array-inline-9-0)
                                                      )
                                                     )
                                                     (call %init_peer_id% ("run-console" "print") [#array-inline-9-0])
                                                    )
                                                   )
                                                  )
                                                  (par
                                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                   (null)
                                                  )
                                                 )
                                                 (fold worker_definition.$.services s-0
                                                  (seq
                                                   (xor
                                                    (seq
                                                     (fold s-0.$.modules m-0
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (call %init_peer_id% ("aqua-ipfs" "get_from") [m-0.$.wasm ipfs] get_wasm)
                                                            (call %init_peer_id% ("aqua-ipfs" "cat_from") [m-0.$.config ipfs] json_cfg)
                                                           )
                                                           (par
                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "enter"])
                                                            (null)
                                                           )
                                                          )
                                                          (new $res
                                                           (seq
                                                            (xor
                                                             (match get_wasm.$.success true
                                                              (ap json_cfg.$.success $res)
                                                             )
                                                             (ap false $res)
                                                            )
                                                            (new $res_test
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (call %init_peer_id% ("math" "add") [0 1] res_incr)
                                                                (fold $res res_fold_var
                                                                 (seq
                                                                  (seq
                                                                   (ap res_fold_var $res_test)
                                                                   (canon %init_peer_id% $res_test  #res_iter_canon)
                                                                  )
                                                                  (xor
                                                                   (match #res_iter_canon.length res_incr
                                                                    (null)
                                                                   )
                                                                   (next res_fold_var)
                                                                  )
                                                                 )
                                                                 (never)
                                                                )
                                                               )
                                                               (canon %init_peer_id% $res_test  #res_result_canon)
                                                              )
                                                              (ap #res_result_canon res_gate)
                                                             )
                                                            )
                                                           )
                                                          )
                                                         )
                                                         (par
                                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "exit"])
                                                          (null)
                                                         )
                                                        )
                                                        (xor
                                                         (match res_gate.$.[0] true
                                                          (xor
                                                           (seq
                                                            (call %init_peer_id% ("json" "parse") [json_cfg.$.contents] cfg)
                                                            (call %init_peer_id% ("dist" "add_module_from_vault") [get_wasm.$.path cfg] $hashes)
                                                           )
                                                           (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 2])
                                                          )
                                                         )
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (par
                                                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                               (null)
                                                              )
                                                              (new $array-inline-10
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (new $array-inline-11
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (ap "wasm" $array-inline-11)
                                                                         (ap m-0.$.wasm $array-inline-11)
                                                                        )
                                                                        (ap get_wasm $array-inline-11)
                                                                       )
                                                                       (canon %init_peer_id% $array-inline-11  #array-inline-11-0)
                                                                      )
                                                                     )
                                                                     (new $array-inline-12
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (ap "config" $array-inline-12)
                                                                         (ap m-0.$.config $array-inline-12)
                                                                        )
                                                                        (ap json_cfg $array-inline-12)
                                                                       )
                                                                       (canon %init_peer_id% $array-inline-12  #array-inline-12-0)
                                                                      )
                                                                     )
                                                                    )
                                                                    (ap s-0.$.name $array-inline-10)
                                                                   )
                                                                   (ap "error retrieving module" $array-inline-10)
                                                                  )
                                                                  (ap #array-inline-11-0 $array-inline-10)
                                                                 )
                                                                 (ap #array-inline-12-0 $array-inline-10)
                                                                )
                                                                (canon %init_peer_id% $array-inline-10  #array-inline-10-0)
                                                               )
                                                              )
                                                             )
                                                             (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-5)
                                                            )
                                                            (call %init_peer_id% ("debug" "stringify") [#array-inline-10-0] str-4)
                                                           )
                                                           (par
                                                            (call %init_peer_id% (spell_id-5 "list_push_string") ["logs" str-4])
                                                            (seq
                                                             (new $array-inline-13
                                                              (seq
                                                               (seq
                                                                (ap spell_id-5 $array-inline-13)
                                                                (ap #array-inline-10-0 $array-inline-13)
                                                               )
                                                               (canon %init_peer_id% $array-inline-13  #array-inline-13-0)
                                                              )
                                                             )
                                                             (call %init_peer_id% ("run-console" "print") [#array-inline-13-0])
                                                            )
                                                           )
                                                          )
                                                          (par
                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                           (null)
                                                          )
                                                         )
                                                        )
                                                       )
                                                       (next m-0)
                                                      )
                                                     )
                                                     (xor
                                                      (seq
                                                       (par
                                                        (seq
                                                         (canon %init_peer_id% $hashes  #hashes_to_functor)
                                                         (ap #hashes_to_functor.length hashes_length)
                                                        )
                                                        (seq
                                                         (seq
                                                          (ap s-0.$.modules s-0_flat)
                                                          (ap s-0_flat s-0_flat_to_functor)
                                                         )
                                                         (ap s-0_flat_to_functor.length s-0_flat_length)
                                                        )
                                                       )
                                                       (match hashes_length s-0_flat_length
                                                        (xor
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (canon %init_peer_id% $hashes  #hashes_canon)
                                                            (call %init_peer_id% ("dist" "make_blueprint") [s-0.$.name #hashes_canon] blueprint)
                                                           )
                                                           (call %init_peer_id% ("dist" "add_blueprint") [blueprint] blueprint_id)
                                                          )
                                                          (xor
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (par
                                                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["is_deployed" "enter"])
                                                               (null)
                                                              )
                                                              (new $result
                                                               (seq
                                                                (seq
                                                                 (call %init_peer_id% ("worker-spell" "get_string") [s-0.$.name] deployed)
                                                                 (xor
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (par
                                                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "enter"])
                                                                      (null)
                                                                     )
                                                                     (new $res-0
                                                                      (seq
                                                                       (xor
                                                                        (match deployed.$.success true
                                                                         (ap deployed.$.absent $res-0)
                                                                        )
                                                                        (ap false $res-0)
                                                                       )
                                                                       (new $res-0_test
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (call %init_peer_id% ("math" "add") [0 1] res-0_incr)
                                                                           (fold $res-0 res-0_fold_var
                                                                            (seq
                                                                             (seq
                                                                              (ap res-0_fold_var $res-0_test)
                                                                              (canon %init_peer_id% $res-0_test  #res-0_iter_canon)
                                                                             )
                                                                             (xor
                                                                              (match #res-0_iter_canon.length res-0_incr
                                                                               (null)
                                                                              )
                                                                              (next res-0_fold_var)
                                                                             )
                                                                            )
                                                                            (never)
                                                                           )
                                                                          )
                                                                          (canon %init_peer_id% $res-0_test  #res-0_result_canon)
                                                                         )
                                                                         (ap #res-0_result_canon res-0_gate)
                                                                        )
                                                                       )
                                                                      )
                                                                     )
                                                                    )
                                                                    (par
                                                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "exit"])
                                                                     (null)
                                                                    )
                                                                   )
                                                                   (match res-0_gate.$.[0] true
                                                                    (ap false $result)
                                                                   )
                                                                  )
                                                                  (seq
                                                                   (seq
                                                                    (ap deployed.$.str deployed_flat)
                                                                    (call %init_peer_id% ("srv" "info") [deployed_flat] info)
                                                                   )
                                                                   (xor
                                                                    (match info.$.blueprint_id blueprint_id
                                                                     (ap true $result)
                                                                    )
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (par
                                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                            (null)
                                                                           )
                                                                           (new $array-inline-14
                                                                            (seq
                                                                             (seq
                                                                              (ap s-0.$.name $array-inline-14)
                                                                              (ap "blueprint changed, need to redeploy" $array-inline-14)
                                                                             )
                                                                             (canon %init_peer_id% $array-inline-14  #array-inline-14-0)
                                                                            )
                                                                           )
                                                                          )
                                                                          (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-6)
                                                                         )
                                                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-14-0] str-5)
                                                                        )
                                                                        (par
                                                                         (call %init_peer_id% (spell_id-6 "list_push_string") ["logs" str-5])
                                                                         (seq
                                                                          (new $array-inline-15
                                                                           (seq
                                                                            (seq
                                                                             (ap spell_id-6 $array-inline-15)
                                                                             (ap #array-inline-14-0 $array-inline-15)
                                                                            )
                                                                            (canon %init_peer_id% $array-inline-15  #array-inline-15-0)
                                                                           )
                                                                          )
                                                                          (call %init_peer_id% ("run-console" "print") [#array-inline-15-0])
                                                                         )
                                                                        )
                                                                       )
                                                                       (par
                                                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                        (null)
                                                                       )
                                                                      )
                                                                      (xor
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (seq
                                                                            (seq
                                                                             (seq
                                                                              (seq
                                                                               (seq
                                                                                (seq
                                                                                 (seq
                                                                                  (seq
                                                                                   (par
                                                                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                                    (null)
                                                                                   )
                                                                                   (new $array-inline-16
                                                                                    (seq
                                                                                     (seq
                                                                                      (seq
                                                                                       (ap s-0.$.name $array-inline-16)
                                                                                       (ap "removing old service" $array-inline-16)
                                                                                      )
                                                                                      (ap deployed_flat $array-inline-16)
                                                                                     )
                                                                                     (canon %init_peer_id% $array-inline-16  #array-inline-16-0)
                                                                                    )
                                                                                   )
                                                                                  )
                                                                                  (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-7)
                                                                                 )
                                                                                 (call %init_peer_id% ("debug" "stringify") [#array-inline-16-0] str-6)
                                                                                )
                                                                                (par
                                                                                 (call %init_peer_id% (spell_id-7 "list_push_string") ["logs" str-6])
                                                                                 (seq
                                                                                  (new $array-inline-17
                                                                                   (seq
                                                                                    (seq
                                                                                     (ap spell_id-7 $array-inline-17)
                                                                                     (ap #array-inline-16-0 $array-inline-17)
                                                                                    )
                                                                                    (canon %init_peer_id% $array-inline-17  #array-inline-17-0)
                                                                                   )
                                                                                  )
                                                                                  (call %init_peer_id% ("run-console" "print") [#array-inline-17-0])
                                                                                 )
                                                                                )
                                                                               )
                                                                               (par
                                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                                (null)
                                                                               )
                                                                              )
                                                                              (call %init_peer_id% ("srv" "remove") [deployed_flat])
                                                                             )
                                                                             (par
                                                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                              (null)
                                                                             )
                                                                            )
                                                                            (new $array-inline-18
                                                                             (seq
                                                                              (seq
                                                                               (seq
                                                                                (ap s-0.$.name $array-inline-18)
                                                                                (ap "old service successfully removed" $array-inline-18)
                                                                               )
                                                                               (ap deployed_flat $array-inline-18)
                                                                              )
                                                                              (canon %init_peer_id% $array-inline-18  #array-inline-18-0)
                                                                             )
                                                                            )
                                                                           )
                                                                           (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-8)
                                                                          )
                                                                          (call %init_peer_id% ("debug" "stringify") [#array-inline-18-0] str-7)
                                                                         )
                                                                         (par
                                                                          (call %init_peer_id% (spell_id-8 "list_push_string") ["logs" str-7])
                                                                          (seq
                                                                           (new $array-inline-19
                                                                            (seq
                                                                             (seq
                                                                              (ap spell_id-8 $array-inline-19)
                                                                              (ap #array-inline-18-0 $array-inline-19)
                                                                             )
                                                                             (canon %init_peer_id% $array-inline-19  #array-inline-19-0)
                                                                            )
                                                                           )
                                                                           (call %init_peer_id% ("run-console" "print") [#array-inline-19-0])
                                                                          )
                                                                         )
                                                                        )
                                                                        (par
                                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                         (null)
                                                                        )
                                                                       )
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (seq
                                                                            (par
                                                                             (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                             (null)
                                                                            )
                                                                            (new $array-inline-20
                                                                             (seq
                                                                              (seq
                                                                               (seq
                                                                                (ap "Error removing service" $array-inline-20)
                                                                                (ap s-0.$.name $array-inline-20)
                                                                               )
                                                                               (ap %last_error% $array-inline-20)
                                                                              )
                                                                              (canon %init_peer_id% $array-inline-20  #array-inline-20-0)
                                                                             )
                                                                            )
                                                                           )
                                                                           (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-9)
                                                                          )
                                                                          (call %init_peer_id% ("debug" "stringify") [#array-inline-20-0] str-8)
                                                                         )
                                                                         (par
                                                                          (call %init_peer_id% (spell_id-9 "list_push_string") ["logs" str-8])
                                                                          (seq
                                                                           (new $array-inline-21
                                                                            (seq
                                                                             (seq
                                                                              (ap spell_id-9 $array-inline-21)
                                                                              (ap #array-inline-20-0 $array-inline-21)
                                                                             )
                                                                             (canon %init_peer_id% $array-inline-21  #array-inline-21-0)
                                                                            )
                                                                           )
                                                                           (call %init_peer_id% ("run-console" "print") [#array-inline-21-0])
                                                                          )
                                                                         )
                                                                        )
                                                                        (par
                                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                         (null)
                                                                        )
                                                                       )
                                                                      )
                                                                     )
                                                                     (ap false $result)
                                                                    )
                                                                   )
                                                                  )
                                                                 )
                                                                )
                                                                (new $result_test
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (call %init_peer_id% ("math" "add") [0 1] result_incr)
                                                                    (fold $result result_fold_var
                                                                     (seq
                                                                      (seq
                                                                       (ap result_fold_var $result_test)
                                                                       (canon %init_peer_id% $result_test  #result_iter_canon)
                                                                      )
                                                                      (xor
                                                                       (match #result_iter_canon.length result_incr
                                                                        (null)
                                                                       )
                                                                       (next result_fold_var)
                                                                      )
                                                                     )
                                                                     (never)
                                                                    )
                                                                   )
                                                                   (canon %init_peer_id% $result_test  #result_result_canon)
                                                                  )
                                                                  (ap #result_result_canon result_gate)
                                                                 )
                                                                )
                                                               )
                                                              )
                                                             )
                                                             (par
                                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["is_deployed" "exit"])
                                                              (null)
                                                             )
                                                            )
                                                            (match result_gate.$.[0] false
                                                             (xor
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (call %init_peer_id% ("worker-spell" "set_string") ["status" "install in progress"])
                                                                           (call %init_peer_id% ("srv" "create") [blueprint_id] service_id)
                                                                          )
                                                                          (par
                                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                           (null)
                                                                          )
                                                                         )
                                                                         (new $array-inline-22
                                                                          (seq
                                                                           (seq
                                                                            (seq
                                                                             (ap "Created service" $array-inline-22)
                                                                             (ap s-0.$.name $array-inline-22)
                                                                            )
                                                                            (ap service_id $array-inline-22)
                                                                           )
                                                                           (canon %init_peer_id% $array-inline-22  #array-inline-22-0)
                                                                          )
                                                                         )
                                                                        )
                                                                        (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-10)
                                                                       )
                                                                       (call %init_peer_id% ("debug" "stringify") [#array-inline-22-0] str-9)
                                                                      )
                                                                      (par
                                                                       (call %init_peer_id% (spell_id-10 "list_push_string") ["logs" str-9])
                                                                       (seq
                                                                        (new $array-inline-23
                                                                         (seq
                                                                          (seq
                                                                           (ap spell_id-10 $array-inline-23)
                                                                           (ap #array-inline-22-0 $array-inline-23)
                                                                          )
                                                                          (canon %init_peer_id% $array-inline-23  #array-inline-23-0)
                                                                         )
                                                                        )
                                                                        (call %init_peer_id% ("run-console" "print") [#array-inline-23-0])
                                                                       )
                                                                      )
                                                                     )
                                                                     (par
                                                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                      (null)
                                                                     )
                                                                    )
                                                                    (xor
                                                                     (call %init_peer_id% ("srv" "add_alias") [s-0.$.name service_id])
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (par
                                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                           (null)
                                                                          )
                                                                          (new $array-inline-24
                                                                           (seq
                                                                            (seq
                                                                             (seq
                                                                              (seq
                                                                               (ap "Error creating alias for deployed service" $array-inline-24)
                                                                               (ap s-0.$.name $array-inline-24)
                                                                              )
                                                                              (ap service_id $array-inline-24)
                                                                             )
                                                                             (ap %last_error% $array-inline-24)
                                                                            )
                                                                            (canon %init_peer_id% $array-inline-24  #array-inline-24-0)
                                                                           )
                                                                          )
                                                                         )
                                                                         (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-11)
                                                                        )
                                                                        (call %init_peer_id% ("debug" "stringify") [#array-inline-24-0] str-10)
                                                                       )
                                                                       (par
                                                                        (call %init_peer_id% (spell_id-11 "list_push_string") ["logs" str-10])
                                                                        (seq
                                                                         (new $array-inline-25
                                                                          (seq
                                                                           (seq
                                                                            (ap spell_id-11 $array-inline-25)
                                                                            (ap #array-inline-24-0 $array-inline-25)
                                                                           )
                                                                           (canon %init_peer_id% $array-inline-25  #array-inline-25-0)
                                                                          )
                                                                         )
                                                                         (call %init_peer_id% ("run-console" "print") [#array-inline-25-0])
                                                                        )
                                                                       )
                                                                      )
                                                                      (par
                                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                       (null)
                                                                      )
                                                                     )
                                                                    )
                                                                   )
                                                                   (call %init_peer_id% ("worker-spell" "set_string") [s-0.$.name service_id])
                                                                  )
                                                                  (par
                                                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["blueprint_key" "enter"])
                                                                   (null)
                                                                  )
                                                                 )
                                                                 (call %init_peer_id% ("op" "concat_strings") ["blueprint:" s-0.$.name] concat_strings)
                                                                )
                                                                (par
                                                                 (call %init_peer_id% ("tracingSrv" "tracingEvent") ["blueprint_key" "exit"])
                                                                 (null)
                                                                )
                                                               )
                                                               (call %init_peer_id% ("worker-spell" "set_string") [concat_strings blueprint_id])
                                                              )
                                                              (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 3])
                                                             )
                                                            )
                                                           )
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (par
                                                                 (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                 (null)
                                                                )
                                                                (new $array-inline-26
                                                                 (seq
                                                                  (seq
                                                                   (ap s-0.$.name $array-inline-26)
                                                                   (ap "service is already deployed, doing nothing" $array-inline-26)
                                                                  )
                                                                  (canon %init_peer_id% $array-inline-26  #array-inline-26-0)
                                                                 )
                                                                )
                                                               )
                                                               (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-12)
                                                              )
                                                              (call %init_peer_id% ("debug" "stringify") [#array-inline-26-0] str-11)
                                                             )
                                                             (par
                                                              (call %init_peer_id% (spell_id-12 "list_push_string") ["logs" str-11])
                                                              (seq
                                                               (new $array-inline-27
                                                                (seq
                                                                 (seq
                                                                  (ap spell_id-12 $array-inline-27)
                                                                  (ap #array-inline-26-0 $array-inline-27)
                                                                 )
                                                                 (canon %init_peer_id% $array-inline-27  #array-inline-27-0)
                                                                )
                                                               )
                                                               (call %init_peer_id% ("run-console" "print") [#array-inline-27-0])
                                                              )
                                                             )
                                                            )
                                                            (par
                                                             (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                             (null)
                                                            )
                                                           )
                                                          )
                                                         )
                                                         (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 4])
                                                        )
                                                       )
                                                      )
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (par
                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                            (null)
                                                           )
                                                           (new $array-inline-28
                                                            (seq
                                                             (seq
                                                              (ap s-0.$.name $array-inline-28)
                                                              (ap "error retrieving some of the modules, see above" $array-inline-28)
                                                             )
                                                             (canon %init_peer_id% $array-inline-28  #array-inline-28-0)
                                                            )
                                                           )
                                                          )
                                                          (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-13)
                                                         )
                                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-28-0] str-12)
                                                        )
                                                        (par
                                                         (call %init_peer_id% (spell_id-13 "list_push_string") ["logs" str-12])
                                                         (seq
                                                          (new $array-inline-29
                                                           (seq
                                                            (seq
                                                             (ap spell_id-13 $array-inline-29)
                                                             (ap #array-inline-28-0 $array-inline-29)
                                                            )
                                                            (canon %init_peer_id% $array-inline-29  #array-inline-29-0)
                                                           )
                                                          )
                                                          (call %init_peer_id% ("run-console" "print") [#array-inline-29-0])
                                                         )
                                                        )
                                                       )
                                                       (par
                                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                        (null)
                                                       )
                                                      )
                                                     )
                                                    )
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (par
                                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                          (null)
                                                         )
                                                         (new $array-inline-30
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (ap s-0.$.name $array-inline-30)
                                                             (ap "error deploying service" $array-inline-30)
                                                            )
                                                            (ap %last_error% $array-inline-30)
                                                           )
                                                           (canon %init_peer_id% $array-inline-30  #array-inline-30-0)
                                                          )
                                                         )
                                                        )
                                                        (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-14)
                                                       )
                                                       (call %init_peer_id% ("debug" "stringify") [#array-inline-30-0] str-13)
                                                      )
                                                      (par
                                                       (call %init_peer_id% (spell_id-14 "list_push_string") ["logs" str-13])
                                                       (seq
                                                        (new $array-inline-31
                                                         (seq
                                                          (seq
                                                           (ap spell_id-14 $array-inline-31)
                                                           (ap #array-inline-30-0 $array-inline-31)
                                                          )
                                                          (canon %init_peer_id% $array-inline-31  #array-inline-31-0)
                                                         )
                                                        )
                                                        (call %init_peer_id% ("run-console" "print") [#array-inline-31-0])
                                                       )
                                                      )
                                                     )
                                                     (par
                                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                      (null)
                                                     )
                                                    )
                                                   )
                                                   (next s-0)
                                                  )
                                                 )
                                                )
                                                (fold worker_definition.$.spells sp-0
                                                 (seq
                                                  (xor
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (par
                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                            (null)
                                                           )
                                                           (new $array-inline-32
                                                            (seq
                                                             (seq
                                                              (ap "Deploying spell" $array-inline-32)
                                                              (ap sp-0.$.name $array-inline-32)
                                                             )
                                                             (canon %init_peer_id% $array-inline-32  #array-inline-32-0)
                                                            )
                                                           )
                                                          )
                                                          (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-15)
                                                         )
                                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-32-0] str-14)
                                                        )
                                                        (par
                                                         (call %init_peer_id% (spell_id-15 "list_push_string") ["logs" str-14])
                                                         (seq
                                                          (new $array-inline-33
                                                           (seq
                                                            (seq
                                                             (ap spell_id-15 $array-inline-33)
                                                             (ap #array-inline-32-0 $array-inline-33)
                                                            )
                                                            (canon %init_peer_id% $array-inline-33  #array-inline-33-0)
                                                           )
                                                          )
                                                          (call %init_peer_id% ("run-console" "print") [#array-inline-33-0])
                                                         )
                                                        )
                                                       )
                                                       (par
                                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                        (null)
                                                       )
                                                      )
                                                      (par
                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["deploy_spell" "enter"])
                                                       (null)
                                                      )
                                                     )
                                                     (xor
                                                      (xor
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (par
                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["is_spell_deployed" "enter"])
                                                           (null)
                                                          )
                                                          (new $result-0
                                                           (seq
                                                            (xor
                                                             (seq
                                                              (call %init_peer_id% ("worker-spell" "get_string") [sp-0.$.name] deployed-0)
                                                              (xor
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (par
                                                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "enter"])
                                                                   (null)
                                                                  )
                                                                  (new $res-1
                                                                   (seq
                                                                    (xor
                                                                     (match deployed-0.$.success true
                                                                      (ap deployed-0.$.absent $res-1)
                                                                     )
                                                                     (ap false $res-1)
                                                                    )
                                                                    (new $res-1_test
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (call %init_peer_id% ("math" "add") [0 1] res-1_incr)
                                                                        (fold $res-1 res-1_fold_var
                                                                         (seq
                                                                          (seq
                                                                           (ap res-1_fold_var $res-1_test)
                                                                           (canon %init_peer_id% $res-1_test  #res-1_iter_canon)
                                                                          )
                                                                          (xor
                                                                           (match #res-1_iter_canon.length res-1_incr
                                                                            (null)
                                                                           )
                                                                           (next res-1_fold_var)
                                                                          )
                                                                         )
                                                                         (never)
                                                                        )
                                                                       )
                                                                       (canon %init_peer_id% $res-1_test  #res-1_result_canon)
                                                                      )
                                                                      (ap #res-1_result_canon res-1_gate)
                                                                     )
                                                                    )
                                                                   )
                                                                  )
                                                                 )
                                                                 (par
                                                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "exit"])
                                                                  (null)
                                                                 )
                                                                )
                                                                (match res-1_gate.$.[0] true
                                                                 (ap false $result-0)
                                                                )
                                                               )
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (ap deployed-0.$.str deployed-0_flat)
                                                                        (call %init_peer_id% ("srv" "info") [deployed-0_flat])
                                                                       )
                                                                       (call %init_peer_id% (deployed-0_flat "script_cid") [] stored_script)
                                                                      )
                                                                      (par
                                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                       (null)
                                                                      )
                                                                     )
                                                                     (new $array-inline-34
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (ap deployed-0_flat $array-inline-34)
                                                                           (ap "script cid was:" $array-inline-34)
                                                                          )
                                                                          (ap stored_script.$.v1_str $array-inline-34)
                                                                         )
                                                                         (ap "new:" $array-inline-34)
                                                                        )
                                                                        (ap sp-0.$.script $array-inline-34)
                                                                       )
                                                                       (canon %init_peer_id% $array-inline-34  #array-inline-34-0)
                                                                      )
                                                                     )
                                                                    )
                                                                    (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-17)
                                                                   )
                                                                   (call %init_peer_id% ("debug" "stringify") [#array-inline-34-0] str-15)
                                                                  )
                                                                  (par
                                                                   (call %init_peer_id% (spell_id-17 "list_push_string") ["logs" str-15])
                                                                   (seq
                                                                    (new $array-inline-35
                                                                     (seq
                                                                      (seq
                                                                       (ap spell_id-17 $array-inline-35)
                                                                       (ap #array-inline-34-0 $array-inline-35)
                                                                      )
                                                                      (canon %init_peer_id% $array-inline-35  #array-inline-35-0)
                                                                     )
                                                                    )
                                                                    (call %init_peer_id% ("run-console" "print") [#array-inline-35-0])
                                                                   )
                                                                  )
                                                                 )
                                                                 (par
                                                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                  (null)
                                                                 )
                                                                )
                                                                (xor
                                                                 (match stored_script.$.v1_str sp-0.$.script
                                                                  (ap true $result-0)
                                                                 )
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (seq
                                                                            (seq
                                                                             (seq
                                                                              (seq
                                                                               (seq
                                                                                (seq
                                                                                 (seq
                                                                                  (seq
                                                                                   (seq
                                                                                    (par
                                                                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                                     (null)
                                                                                    )
                                                                                    (new $array-inline-36
                                                                                     (seq
                                                                                      (seq
                                                                                       (ap sp-0.$.name $array-inline-36)
                                                                                       (ap "script changed, need to redeploy" $array-inline-36)
                                                                                      )
                                                                                      (canon %init_peer_id% $array-inline-36  #array-inline-36-0)
                                                                                     )
                                                                                    )
                                                                                   )
                                                                                   (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-18)
                                                                                  )
                                                                                  (call %init_peer_id% ("debug" "stringify") [#array-inline-36-0] str-16)
                                                                                 )
                                                                                 (par
                                                                                  (call %init_peer_id% (spell_id-18 "list_push_string") ["logs" str-16])
                                                                                  (seq
                                                                                   (new $array-inline-37
                                                                                    (seq
                                                                                     (seq
                                                                                      (ap spell_id-18 $array-inline-37)
                                                                                      (ap #array-inline-36-0 $array-inline-37)
                                                                                     )
                                                                                     (canon %init_peer_id% $array-inline-37  #array-inline-37-0)
                                                                                    )
                                                                                   )
                                                                                   (call %init_peer_id% ("run-console" "print") [#array-inline-37-0])
                                                                                  )
                                                                                 )
                                                                                )
                                                                                (par
                                                                                 (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                                 (null)
                                                                                )
                                                                               )
                                                                               (par
                                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                                (null)
                                                                               )
                                                                              )
                                                                              (new $array-inline-38
                                                                               (seq
                                                                                (seq
                                                                                 (seq
                                                                                  (ap sp-0.$.name $array-inline-38)
                                                                                  (ap "removing old spell" $array-inline-38)
                                                                                 )
                                                                                 (ap deployed-0_flat $array-inline-38)
                                                                                )
                                                                                (canon %init_peer_id% $array-inline-38  #array-inline-38-0)
                                                                               )
                                                                              )
                                                                             )
                                                                             (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-19)
                                                                            )
                                                                            (call %init_peer_id% ("debug" "stringify") [#array-inline-38-0] str-17)
                                                                           )
                                                                           (par
                                                                            (call %init_peer_id% (spell_id-19 "list_push_string") ["logs" str-17])
                                                                            (seq
                                                                             (new $array-inline-39
                                                                              (seq
                                                                               (seq
                                                                                (ap spell_id-19 $array-inline-39)
                                                                                (ap #array-inline-38-0 $array-inline-39)
                                                                               )
                                                                               (canon %init_peer_id% $array-inline-39  #array-inline-39-0)
                                                                              )
                                                                             )
                                                                             (call %init_peer_id% ("run-console" "print") [#array-inline-39-0])
                                                                            )
                                                                           )
                                                                          )
                                                                          (par
                                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                           (null)
                                                                          )
                                                                         )
                                                                         (call %init_peer_id% ("spell" "remove") [deployed-0_flat])
                                                                        )
                                                                        (par
                                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                         (null)
                                                                        )
                                                                       )
                                                                       (new $array-inline-40
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (ap sp-0.$.name $array-inline-40)
                                                                           (ap "old spell successfully removed" $array-inline-40)
                                                                          )
                                                                          (ap deployed-0_flat $array-inline-40)
                                                                         )
                                                                         (canon %init_peer_id% $array-inline-40  #array-inline-40-0)
                                                                        )
                                                                       )
                                                                      )
                                                                      (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-20)
                                                                     )
                                                                     (call %init_peer_id% ("debug" "stringify") [#array-inline-40-0] str-18)
                                                                    )
                                                                    (par
                                                                     (call %init_peer_id% (spell_id-20 "list_push_string") ["logs" str-18])
                                                                     (seq
                                                                      (new $array-inline-41
                                                                       (seq
                                                                        (seq
                                                                         (ap spell_id-20 $array-inline-41)
                                                                         (ap #array-inline-40-0 $array-inline-41)
                                                                        )
                                                                        (canon %init_peer_id% $array-inline-41  #array-inline-41-0)
                                                                       )
                                                                      )
                                                                      (call %init_peer_id% ("run-console" "print") [#array-inline-41-0])
                                                                     )
                                                                    )
                                                                   )
                                                                   (par
                                                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                    (null)
                                                                   )
                                                                  )
                                                                  (ap false $result-0)
                                                                 )
                                                                )
                                                               )
                                                              )
                                                             )
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (par
                                                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                    (null)
                                                                   )
                                                                   (new $array-inline-42
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (ap "Error check spell deployed" $array-inline-42)
                                                                       (ap sp-0.$.name $array-inline-42)
                                                                      )
                                                                      (ap %last_error% $array-inline-42)
                                                                     )
                                                                     (canon %init_peer_id% $array-inline-42  #array-inline-42-0)
                                                                    )
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-21)
                                                                 )
                                                                 (call %init_peer_id% ("debug" "stringify") [#array-inline-42-0] str-19)
                                                                )
                                                                (par
                                                                 (call %init_peer_id% (spell_id-21 "list_push_string") ["logs" str-19])
                                                                 (seq
                                                                  (new $array-inline-43
                                                                   (seq
                                                                    (seq
                                                                     (ap spell_id-21 $array-inline-43)
                                                                     (ap #array-inline-42-0 $array-inline-43)
                                                                    )
                                                                    (canon %init_peer_id% $array-inline-43  #array-inline-43-0)
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("run-console" "print") [#array-inline-43-0])
                                                                 )
                                                                )
                                                               )
                                                               (par
                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                (null)
                                                               )
                                                              )
                                                              (ap false $result-0)
                                                             )
                                                            )
                                                            (new $result-0_test
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (call %init_peer_id% ("math" "add") [0 1] result-0_incr)
                                                                (fold $result-0 result-0_fold_var
                                                                 (seq
                                                                  (seq
                                                                   (ap result-0_fold_var $result-0_test)
                                                                   (canon %init_peer_id% $result-0_test  #result-0_iter_canon)
                                                                  )
                                                                  (xor
                                                                   (match #result-0_iter_canon.length result-0_incr
                                                                    (null)
                                                                   )
                                                                   (next result-0_fold_var)
                                                                  )
                                                                 )
                                                                 (never)
                                                                )
                                                               )
                                                               (canon %init_peer_id% $result-0_test  #result-0_result_canon)
                                                              )
                                                              (ap #result-0_result_canon result-0_gate)
                                                             )
                                                            )
                                                           )
                                                          )
                                                         )
                                                         (par
                                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["is_spell_deployed" "exit"])
                                                          (null)
                                                         )
                                                        )
                                                        (match result-0_gate.$.[0] true
                                                         (xor
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (par
                                                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                          (null)
                                                                         )
                                                                         (new $array-inline-44
                                                                          (seq
                                                                           (seq
                                                                            (ap sp-0.$.name $array-inline-44)
                                                                            (ap "spell is already deployed, checking config and init_args" $array-inline-44)
                                                                           )
                                                                           (canon %init_peer_id% $array-inline-44  #array-inline-44-0)
                                                                          )
                                                                         )
                                                                        )
                                                                        (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-22)
                                                                       )
                                                                       (call %init_peer_id% ("debug" "stringify") [#array-inline-44-0] str-20)
                                                                      )
                                                                      (par
                                                                       (call %init_peer_id% (spell_id-22 "list_push_string") ["logs" str-20])
                                                                       (seq
                                                                        (new $array-inline-45
                                                                         (seq
                                                                          (seq
                                                                           (ap spell_id-22 $array-inline-45)
                                                                           (ap #array-inline-44-0 $array-inline-45)
                                                                          )
                                                                          (canon %init_peer_id% $array-inline-45  #array-inline-45-0)
                                                                         )
                                                                        )
                                                                        (call %init_peer_id% ("run-console" "print") [#array-inline-45-0])
                                                                       )
                                                                      )
                                                                     )
                                                                     (par
                                                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                      (null)
                                                                     )
                                                                    )
                                                                    (par
                                                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["config_key" "enter"])
                                                                     (null)
                                                                    )
                                                                   )
                                                                   (call %init_peer_id% ("op" "concat_strings") ["trigger_config:" sp-0.$.name] concat_strings-0)
                                                                  )
                                                                  (par
                                                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["config_key" "exit"])
                                                                   (null)
                                                                  )
                                                                 )
                                                                 (call %init_peer_id% ("worker-spell" "get_string") [concat_strings-0] stored_config)
                                                                )
                                                                (xor
                                                                 (mismatch stored_config.$.str sp-0.$.config
                                                                  (xor
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (par
                                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                           (null)
                                                                          )
                                                                          (new $array-inline-46
                                                                           (seq
                                                                            (seq
                                                                             (ap sp-0.$.name $array-inline-46)
                                                                             (ap "config mismath, updating config" $array-inline-46)
                                                                            )
                                                                            (canon %init_peer_id% $array-inline-46  #array-inline-46-0)
                                                                           )
                                                                          )
                                                                         )
                                                                         (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-23)
                                                                        )
                                                                        (call %init_peer_id% ("debug" "stringify") [#array-inline-46-0] str-21)
                                                                       )
                                                                       (par
                                                                        (call %init_peer_id% (spell_id-23 "list_push_string") ["logs" str-21])
                                                                        (seq
                                                                         (new $array-inline-47
                                                                          (seq
                                                                           (seq
                                                                            (ap spell_id-23 $array-inline-47)
                                                                            (ap #array-inline-46-0 $array-inline-47)
                                                                           )
                                                                           (canon %init_peer_id% $array-inline-47  #array-inline-47-0)
                                                                          )
                                                                         )
                                                                         (call %init_peer_id% ("run-console" "print") [#array-inline-47-0])
                                                                        )
                                                                       )
                                                                      )
                                                                      (par
                                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                       (null)
                                                                      )
                                                                     )
                                                                     (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.config ipfs] config_json)
                                                                    )
                                                                    (xor
                                                                     (match config_json.$.success true
                                                                      (xor
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (seq
                                                                            (seq
                                                                             (seq
                                                                              (seq
                                                                               (seq
                                                                                (seq
                                                                                 (seq
                                                                                  (seq
                                                                                   (call %init_peer_id% ("json" "parse") [config_json.$.contents] config)
                                                                                   (call %init_peer_id% ("srv" "resolve_alias") [sp-0.$.name] spell_id-16)
                                                                                  )
                                                                                  (call %init_peer_id% ("spell" "update_trigger_config") [spell_id-16 config])
                                                                                 )
                                                                                 (par
                                                                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["config_key" "enter"])
                                                                                  (null)
                                                                                 )
                                                                                )
                                                                                (call %init_peer_id% ("op" "concat_strings") ["trigger_config:" sp-0.$.name] concat_strings-1)
                                                                               )
                                                                               (par
                                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["config_key" "exit"])
                                                                                (null)
                                                                               )
                                                                              )
                                                                              (call %init_peer_id% ("worker-spell" "set_string") [concat_strings-1 sp-0.$.config])
                                                                             )
                                                                             (par
                                                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                              (null)
                                                                             )
                                                                            )
                                                                            (new $array-inline-48
                                                                             (seq
                                                                              (seq
                                                                               (ap sp-0.$.name $array-inline-48)
                                                                               (ap "config successfully updated" $array-inline-48)
                                                                              )
                                                                              (canon %init_peer_id% $array-inline-48  #array-inline-48-0)
                                                                             )
                                                                            )
                                                                           )
                                                                           (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-24)
                                                                          )
                                                                          (call %init_peer_id% ("debug" "stringify") [#array-inline-48-0] str-22)
                                                                         )
                                                                         (par
                                                                          (call %init_peer_id% (spell_id-24 "list_push_string") ["logs" str-22])
                                                                          (seq
                                                                           (new $array-inline-49
                                                                            (seq
                                                                             (seq
                                                                              (ap spell_id-24 $array-inline-49)
                                                                              (ap #array-inline-48-0 $array-inline-49)
                                                                             )
                                                                             (canon %init_peer_id% $array-inline-49  #array-inline-49-0)
                                                                            )
                                                                           )
                                                                           (call %init_peer_id% ("run-console" "print") [#array-inline-49-0])
                                                                          )
                                                                         )
                                                                        )
                                                                        (par
                                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                         (null)
                                                                        )
                                                                       )
                                                                       (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 5])
                                                                      )
                                                                     )
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (par
                                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                           (null)
                                                                          )
                                                                          (new $array-inline-50
                                                                           (seq
                                                                            (seq
                                                                             (seq
                                                                              (seq
                                                                               (ap sp-0.$.name $array-inline-50)
                                                                               (ap "error retrieving config" $array-inline-50)
                                                                              )
                                                                              (ap sp-0.$.config $array-inline-50)
                                                                             )
                                                                             (ap config_json.$.error $array-inline-50)
                                                                            )
                                                                            (canon %init_peer_id% $array-inline-50  #array-inline-50-0)
                                                                           )
                                                                          )
                                                                         )
                                                                         (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-25)
                                                                        )
                                                                        (call %init_peer_id% ("debug" "stringify") [#array-inline-50-0] str-23)
                                                                       )
                                                                       (par
                                                                        (call %init_peer_id% (spell_id-25 "list_push_string") ["logs" str-23])
                                                                        (seq
                                                                         (new $array-inline-51
                                                                          (seq
                                                                           (seq
                                                                            (ap spell_id-25 $array-inline-51)
                                                                            (ap #array-inline-50-0 $array-inline-51)
                                                                           )
                                                                           (canon %init_peer_id% $array-inline-51  #array-inline-51-0)
                                                                          )
                                                                         )
                                                                         (call %init_peer_id% ("run-console" "print") [#array-inline-51-0])
                                                                        )
                                                                       )
                                                                      )
                                                                      (par
                                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                       (null)
                                                                      )
                                                                     )
                                                                    )
                                                                   )
                                                                   (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 6])
                                                                  )
                                                                 )
                                                                 (call %init_peer_id% ("op" "noop") [])
                                                                )
                                                               )
                                                               (par
                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["init_args_key" "enter"])
                                                                (null)
                                                               )
                                                              )
                                                              (call %init_peer_id% ("op" "concat_strings") ["init_args:" sp-0.$.name] concat_strings-2)
                                                             )
                                                             (par
                                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["init_args_key" "exit"])
                                                              (null)
                                                             )
                                                            )
                                                            (call %init_peer_id% ("worker-spell" "get_string") [concat_strings-2] stored_init_args)
                                                           )
                                                           (xor
                                                            (mismatch stored_init_args.$.str sp-0.$.init_args
                                                             (xor
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (seq
                                                                            (seq
                                                                             (seq
                                                                              (seq
                                                                               (par
                                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                                (null)
                                                                               )
                                                                               (new $array-inline-52
                                                                                (seq
                                                                                 (seq
                                                                                  (ap sp-0.$.name $array-inline-52)
                                                                                  (ap "init_args changed, updating" $array-inline-52)
                                                                                 )
                                                                                 (canon %init_peer_id% $array-inline-52  #array-inline-52-0)
                                                                                )
                                                                               )
                                                                              )
                                                                              (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-26)
                                                                             )
                                                                             (call %init_peer_id% ("debug" "stringify") [#array-inline-52-0] str-24)
                                                                            )
                                                                            (par
                                                                             (call %init_peer_id% (spell_id-26 "list_push_string") ["logs" str-24])
                                                                             (seq
                                                                              (new $array-inline-53
                                                                               (seq
                                                                                (seq
                                                                                 (ap spell_id-26 $array-inline-53)
                                                                                 (ap #array-inline-52-0 $array-inline-53)
                                                                                )
                                                                                (canon %init_peer_id% $array-inline-53  #array-inline-53-0)
                                                                               )
                                                                              )
                                                                              (call %init_peer_id% ("run-console" "print") [#array-inline-53-0])
                                                                             )
                                                                            )
                                                                           )
                                                                           (par
                                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                            (null)
                                                                           )
                                                                          )
                                                                          (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.init_args ipfs] new_init_args)
                                                                         )
                                                                         (xor
                                                                          (match new_init_args.$.success true
                                                                           (xor
                                                                            (call %init_peer_id% (sp-0.$.name "set_json_fields") [new_init_args.$.contents])
                                                                            (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 7])
                                                                           )
                                                                          )
                                                                          (seq
                                                                           (seq
                                                                            (seq
                                                                             (seq
                                                                              (seq
                                                                               (par
                                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                                (null)
                                                                               )
                                                                               (new $array-inline-54
                                                                                (seq
                                                                                 (seq
                                                                                  (seq
                                                                                   (seq
                                                                                    (ap sp-0.$.name $array-inline-54)
                                                                                    (ap "error retrieving init_args" $array-inline-54)
                                                                                   )
                                                                                   (ap sp-0.$.init_args $array-inline-54)
                                                                                  )
                                                                                  (ap new_init_args.$.error $array-inline-54)
                                                                                 )
                                                                                 (canon %init_peer_id% $array-inline-54  #array-inline-54-0)
                                                                                )
                                                                               )
                                                                              )
                                                                              (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-27)
                                                                             )
                                                                             (call %init_peer_id% ("debug" "stringify") [#array-inline-54-0] str-25)
                                                                            )
                                                                            (par
                                                                             (call %init_peer_id% (spell_id-27 "list_push_string") ["logs" str-25])
                                                                             (seq
                                                                              (new $array-inline-55
                                                                               (seq
                                                                                (seq
                                                                                 (ap spell_id-27 $array-inline-55)
                                                                                 (ap #array-inline-54-0 $array-inline-55)
                                                                                )
                                                                                (canon %init_peer_id% $array-inline-55  #array-inline-55-0)
                                                                               )
                                                                              )
                                                                              (call %init_peer_id% ("run-console" "print") [#array-inline-55-0])
                                                                             )
                                                                            )
                                                                           )
                                                                           (par
                                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                            (null)
                                                                           )
                                                                          )
                                                                         )
                                                                        )
                                                                        (par
                                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["init_args_key" "enter"])
                                                                         (null)
                                                                        )
                                                                       )
                                                                       (call %init_peer_id% ("op" "concat_strings") ["init_args:" sp-0.$.name] concat_strings-3)
                                                                      )
                                                                      (par
                                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["init_args_key" "exit"])
                                                                       (null)
                                                                      )
                                                                     )
                                                                     (call %init_peer_id% ("worker-spell" "set_string") [concat_strings-3 sp-0.$.init_args])
                                                                    )
                                                                    (par
                                                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                     (null)
                                                                    )
                                                                   )
                                                                   (new $array-inline-56
                                                                    (seq
                                                                     (seq
                                                                      (ap sp-0.$.name $array-inline-56)
                                                                      (ap "init_args successfully updated" $array-inline-56)
                                                                     )
                                                                     (canon %init_peer_id% $array-inline-56  #array-inline-56-0)
                                                                    )
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-28)
                                                                 )
                                                                 (call %init_peer_id% ("debug" "stringify") [#array-inline-56-0] str-26)
                                                                )
                                                                (par
                                                                 (call %init_peer_id% (spell_id-28 "list_push_string") ["logs" str-26])
                                                                 (seq
                                                                  (new $array-inline-57
                                                                   (seq
                                                                    (seq
                                                                     (ap spell_id-28 $array-inline-57)
                                                                     (ap #array-inline-56-0 $array-inline-57)
                                                                    )
                                                                    (canon %init_peer_id% $array-inline-57  #array-inline-57-0)
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("run-console" "print") [#array-inline-57-0])
                                                                 )
                                                                )
                                                               )
                                                               (par
                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                (null)
                                                               )
                                                              )
                                                              (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 8])
                                                             )
                                                            )
                                                            (call %init_peer_id% ("op" "noop") [])
                                                           )
                                                          )
                                                          (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 9])
                                                         )
                                                        )
                                                       )
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (call %init_peer_id% ("worker-spell" "set_string") ["status" "install in progress"])
                                                                 (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.script ipfs] script)
                                                                )
                                                                (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.config ipfs] cfg_json)
                                                               )
                                                               (call %init_peer_id% ("aqua-ipfs" "cat_from") [sp-0.$.init_args ipfs] init_args_str)
                                                              )
                                                              (par
                                                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "enter"])
                                                               (null)
                                                              )
                                                             )
                                                             (par
                                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "enter"])
                                                              (null)
                                                             )
                                                            )
                                                            (new $res-2
                                                             (seq
                                                              (xor
                                                               (match script.$.success true
                                                                (ap cfg_json.$.success $res-2)
                                                               )
                                                               (ap false $res-2)
                                                              )
                                                              (new $res-2_test
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (call %init_peer_id% ("math" "add") [0 1] res-2_incr)
                                                                  (fold $res-2 res-2_fold_var
                                                                   (seq
                                                                    (seq
                                                                     (ap res-2_fold_var $res-2_test)
                                                                     (canon %init_peer_id% $res-2_test  #res-2_iter_canon)
                                                                    )
                                                                    (xor
                                                                     (match #res-2_iter_canon.length res-2_incr
                                                                      (null)
                                                                     )
                                                                     (next res-2_fold_var)
                                                                    )
                                                                   )
                                                                   (never)
                                                                  )
                                                                 )
                                                                 (canon %init_peer_id% $res-2_test  #res-2_result_canon)
                                                                )
                                                                (ap #res-2_result_canon res-2_gate)
                                                               )
                                                              )
                                                             )
                                                            )
                                                           )
                                                           (par
                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "exit"])
                                                            (null)
                                                           )
                                                          )
                                                          (new $res-3
                                                           (seq
                                                            (xor
                                                             (match res-2_gate.$.[0] true
                                                              (ap init_args_str.$.success $res-3)
                                                             )
                                                             (ap false $res-3)
                                                            )
                                                            (new $res-3_test
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (call %init_peer_id% ("math" "add") [0 1] res-3_incr)
                                                                (fold $res-3 res-3_fold_var
                                                                 (seq
                                                                  (seq
                                                                   (ap res-3_fold_var $res-3_test)
                                                                   (canon %init_peer_id% $res-3_test  #res-3_iter_canon)
                                                                  )
                                                                  (xor
                                                                   (match #res-3_iter_canon.length res-3_incr
                                                                    (null)
                                                                   )
                                                                   (next res-3_fold_var)
                                                                  )
                                                                 )
                                                                 (never)
                                                                )
                                                               )
                                                               (canon %init_peer_id% $res-3_test  #res-3_result_canon)
                                                              )
                                                              (ap #res-3_result_canon res-3_gate)
                                                             )
                                                            )
                                                           )
                                                          )
                                                         )
                                                         (par
                                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["and" "exit"])
                                                          (null)
                                                         )
                                                        )
                                                        (xor
                                                         (match res-3_gate.$.[0] true
                                                          (xor
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (seq
                                                                            (seq
                                                                             (call %init_peer_id% ("json" "parse") [cfg_json.$.contents] cfg-0)
                                                                             (call %init_peer_id% ("json" "parse") [init_args_str.$.contents] init_args)
                                                                            )
                                                                            (call %init_peer_id% ("spell" "install") [script.$.contents init_args cfg-0] sp_id)
                                                                           )
                                                                           (par
                                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                            (null)
                                                                           )
                                                                          )
                                                                          (new $array-inline-58
                                                                           (seq
                                                                            (seq
                                                                             (seq
                                                                              (ap "Installed spell" $array-inline-58)
                                                                              (ap sp-0.$.name $array-inline-58)
                                                                             )
                                                                             (ap sp_id $array-inline-58)
                                                                            )
                                                                            (canon %init_peer_id% $array-inline-58  #array-inline-58-0)
                                                                           )
                                                                          )
                                                                         )
                                                                         (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-29)
                                                                        )
                                                                        (call %init_peer_id% ("debug" "stringify") [#array-inline-58-0] str-27)
                                                                       )
                                                                       (par
                                                                        (call %init_peer_id% (spell_id-29 "list_push_string") ["logs" str-27])
                                                                        (seq
                                                                         (new $array-inline-59
                                                                          (seq
                                                                           (seq
                                                                            (ap spell_id-29 $array-inline-59)
                                                                            (ap #array-inline-58-0 $array-inline-59)
                                                                           )
                                                                           (canon %init_peer_id% $array-inline-59  #array-inline-59-0)
                                                                          )
                                                                         )
                                                                         (call %init_peer_id% ("run-console" "print") [#array-inline-59-0])
                                                                        )
                                                                       )
                                                                      )
                                                                      (par
                                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                       (null)
                                                                      )
                                                                     )
                                                                     (xor
                                                                      (call %init_peer_id% ("srv" "add_alias") [sp-0.$.name sp_id])
                                                                      (seq
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (par
                                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                                            (null)
                                                                           )
                                                                           (new $array-inline-60
                                                                            (seq
                                                                             (seq
                                                                              (seq
                                                                               (seq
                                                                                (ap "Error creating alias for deployed spell" $array-inline-60)
                                                                                (ap sp-0.$.name $array-inline-60)
                                                                               )
                                                                               (ap sp_id $array-inline-60)
                                                                              )
                                                                              (ap %last_error% $array-inline-60)
                                                                             )
                                                                             (canon %init_peer_id% $array-inline-60  #array-inline-60-0)
                                                                            )
                                                                           )
                                                                          )
                                                                          (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-30)
                                                                         )
                                                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-60-0] str-28)
                                                                        )
                                                                        (par
                                                                         (call %init_peer_id% (spell_id-30 "list_push_string") ["logs" str-28])
                                                                         (seq
                                                                          (new $array-inline-61
                                                                           (seq
                                                                            (seq
                                                                             (ap spell_id-30 $array-inline-61)
                                                                             (ap #array-inline-60-0 $array-inline-61)
                                                                            )
                                                                            (canon %init_peer_id% $array-inline-61  #array-inline-61-0)
                                                                           )
                                                                          )
                                                                          (call %init_peer_id% ("run-console" "print") [#array-inline-61-0])
                                                                         )
                                                                        )
                                                                       )
                                                                       (par
                                                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                                        (null)
                                                                       )
                                                                      )
                                                                     )
                                                                    )
                                                                    (call %init_peer_id% ("worker-spell" "set_string") [sp-0.$.name sp_id])
                                                                   )
                                                                   (par
                                                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["config_key" "enter"])
                                                                    (null)
                                                                   )
                                                                  )
                                                                  (call %init_peer_id% ("op" "concat_strings") ["trigger_config:" sp-0.$.name] concat_strings-4)
                                                                 )
                                                                 (par
                                                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["config_key" "exit"])
                                                                  (null)
                                                                 )
                                                                )
                                                                (call %init_peer_id% ("worker-spell" "set_string") [concat_strings-4 sp-0.$.config])
                                                               )
                                                               (par
                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["init_args_key" "enter"])
                                                                (null)
                                                               )
                                                              )
                                                              (call %init_peer_id% ("op" "concat_strings") ["init_args:" sp-0.$.name] concat_strings-5)
                                                             )
                                                             (par
                                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["init_args_key" "exit"])
                                                              (null)
                                                             )
                                                            )
                                                            (call %init_peer_id% ("worker-spell" "set_string") [concat_strings-5 sp-0.$.init_args])
                                                           )
                                                           (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 10])
                                                          )
                                                         )
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (par
                                                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                               (null)
                                                              )
                                                              (new $array-inline-62
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (new $array-inline-63
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (ap "script" $array-inline-63)
                                                                           (ap sp-0.$.script $array-inline-63)
                                                                          )
                                                                          (ap script $array-inline-63)
                                                                         )
                                                                         (canon %init_peer_id% $array-inline-63  #array-inline-63-0)
                                                                        )
                                                                       )
                                                                       (new $array-inline-64
                                                                        (seq
                                                                         (seq
                                                                          (seq
                                                                           (ap "cfg_json" $array-inline-64)
                                                                           (ap sp-0.$.config $array-inline-64)
                                                                          )
                                                                          (ap cfg_json $array-inline-64)
                                                                         )
                                                                         (canon %init_peer_id% $array-inline-64  #array-inline-64-0)
                                                                        )
                                                                       )
                                                                      )
                                                                      (new $array-inline-65
                                                                       (seq
                                                                        (seq
                                                                         (seq
                                                                          (ap "init_args_str" $array-inline-65)
                                                                          (ap sp-0.$.init_args $array-inline-65)
                                                                         )
                                                                         (ap init_args_str $array-inline-65)
                                                                        )
                                                                        (canon %init_peer_id% $array-inline-65  #array-inline-65-0)
                                                                       )
                                                                      )
                                                                     )
                                                                     (ap sp-0.$.name $array-inline-62)
                                                                    )
                                                                    (ap "error retrieving from IPFS" $array-inline-62)
                                                                   )
                                                                   (ap #array-inline-63-0 $array-inline-62)
                                                                  )
                                                                  (ap #array-inline-64-0 $array-inline-62)
                                                                 )
                                                                 (ap #array-inline-65-0 $array-inline-62)
                                                                )
                                                                (canon %init_peer_id% $array-inline-62  #array-inline-62-0)
                                                               )
                                                              )
                                                             )
                                                             (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-31)
                                                            )
                                                            (call %init_peer_id% ("debug" "stringify") [#array-inline-62-0] str-29)
                                                           )
                                                           (par
                                                            (call %init_peer_id% (spell_id-31 "list_push_string") ["logs" str-29])
                                                            (seq
                                                             (new $array-inline-66
                                                              (seq
                                                               (seq
                                                                (ap spell_id-31 $array-inline-66)
                                                                (ap #array-inline-62-0 $array-inline-66)
                                                               )
                                                               (canon %init_peer_id% $array-inline-66  #array-inline-66-0)
                                                              )
                                                             )
                                                             (call %init_peer_id% ("run-console" "print") [#array-inline-66-0])
                                                            )
                                                           )
                                                          )
                                                          (par
                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                           (null)
                                                          )
                                                         )
                                                        )
                                                       )
                                                      )
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (par
                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                            (null)
                                                           )
                                                           (new $array-inline-67
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (ap "Error deploy spell" $array-inline-67)
                                                               (ap sp-0.$.name $array-inline-67)
                                                              )
                                                              (ap %last_error% $array-inline-67)
                                                             )
                                                             (canon %init_peer_id% $array-inline-67  #array-inline-67-0)
                                                            )
                                                           )
                                                          )
                                                          (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-32)
                                                         )
                                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-67-0] str-30)
                                                        )
                                                        (par
                                                         (call %init_peer_id% (spell_id-32 "list_push_string") ["logs" str-30])
                                                         (seq
                                                          (new $array-inline-68
                                                           (seq
                                                            (seq
                                                             (ap spell_id-32 $array-inline-68)
                                                             (ap #array-inline-67-0 $array-inline-68)
                                                            )
                                                            (canon %init_peer_id% $array-inline-68  #array-inline-68-0)
                                                           )
                                                          )
                                                          (call %init_peer_id% ("run-console" "print") [#array-inline-68-0])
                                                         )
                                                        )
                                                       )
                                                       (par
                                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                        (null)
                                                       )
                                                      )
                                                     )
                                                    )
                                                    (par
                                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["deploy_spell" "exit"])
                                                     (null)
                                                    )
                                                   )
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (par
                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                         (null)
                                                        )
                                                        (new $array-inline-69
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (ap "Error deploying spell" $array-inline-69)
                                                            (ap sp-0.$.name $array-inline-69)
                                                           )
                                                           (ap %last_error% $array-inline-69)
                                                          )
                                                          (canon %init_peer_id% $array-inline-69  #array-inline-69-0)
                                                         )
                                                        )
                                                       )
                                                       (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-33)
                                                      )
                                                      (call %init_peer_id% ("debug" "stringify") [#array-inline-69-0] str-31)
                                                     )
                                                     (par
                                                      (call %init_peer_id% (spell_id-33 "list_push_string") ["logs" str-31])
                                                      (seq
                                                       (new $array-inline-70
                                                        (seq
                                                         (seq
                                                          (ap spell_id-33 $array-inline-70)
                                                          (ap #array-inline-69-0 $array-inline-70)
                                                         )
                                                         (canon %init_peer_id% $array-inline-70  #array-inline-70-0)
                                                        )
                                                       )
                                                       (call %init_peer_id% ("run-console" "print") [#array-inline-70-0])
                                                      )
                                                     )
                                                    )
                                                    (par
                                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                     (null)
                                                    )
                                                   )
                                                  )
                                                  (next sp-0)
                                                 )
                                                )
                                               )
                                               (par
                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                (null)
                                               )
                                              )
                                              (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-34)
                                             )
                                             (call %init_peer_id% ("debug" "stringify") ["Installation finished"] str-32)
                                            )
                                            (par
                                             (call %init_peer_id% (spell_id-34 "list_push_string") ["logs" str-32])
                                             (seq
                                              (new $array-inline-71
                                               (seq
                                                (seq
                                                 (ap spell_id-34 $array-inline-71)
                                                 (ap "Installation finished" $array-inline-71)
                                                )
                                                (canon %init_peer_id% $array-inline-71  #array-inline-71-0)
                                               )
                                              )
                                              (call %init_peer_id% ("run-console" "print") [#array-inline-71-0])
                                             )
                                            )
                                           )
                                           (par
                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                            (null)
                                           )
                                          )
                                          (call %init_peer_id% ("worker-spell" "set_string") ["status" "install finished"])
                                         )
                                         (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 11])
                                        )
                                       )
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (par
                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                              (null)
                                             )
                                             (new $array-inline-72
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (ap "Error downloading worker definition from IPFS" $array-inline-72)
                                                  (ap ipfs $array-inline-72)
                                                 )
                                                 (ap worker_def_cid $array-inline-72)
                                                )
                                                (ap json $array-inline-72)
                                               )
                                               (canon %init_peer_id% $array-inline-72  #array-inline-72-0)
                                              )
                                             )
                                            )
                                            (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-35)
                                           )
                                           (call %init_peer_id% ("debug" "stringify") [#array-inline-72-0] str-33)
                                          )
                                          (par
                                           (call %init_peer_id% (spell_id-35 "list_push_string") ["logs" str-33])
                                           (seq
                                            (new $array-inline-73
                                             (seq
                                              (seq
                                               (ap spell_id-35 $array-inline-73)
                                               (ap #array-inline-72-0 $array-inline-73)
                                              )
                                              (canon %init_peer_id% $array-inline-73  #array-inline-73-0)
                                             )
                                            )
                                            (call %init_peer_id% ("run-console" "print") [#array-inline-73-0])
                                           )
                                          )
                                         )
                                         (par
                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                          (null)
                                         )
                                        )
                                        (call %init_peer_id% ("worker-spell" "set_string") ["status" "install error"])
                                       )
                                      )
                                     )
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (par
                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                            (null)
                                           )
                                           (new $array-inline-74
                                            (seq
                                             (seq
                                              (ap "Error installing worker" $array-inline-74)
                                              (ap %last_error% $array-inline-74)
                                             )
                                             (canon %init_peer_id% $array-inline-74  #array-inline-74-0)
                                            )
                                           )
                                          )
                                          (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-36)
                                         )
                                         (call %init_peer_id% ("debug" "stringify") [#array-inline-74-0] str-34)
                                        )
                                        (par
                                         (call %init_peer_id% (spell_id-36 "list_push_string") ["logs" str-34])
                                         (seq
                                          (new $array-inline-75
                                           (seq
                                            (seq
                                             (ap spell_id-36 $array-inline-75)
                                             (ap #array-inline-74-0 $array-inline-75)
                                            )
                                            (canon %init_peer_id% $array-inline-75  #array-inline-75-0)
                                           )
                                          )
                                          (call %init_peer_id% ("run-console" "print") [#array-inline-75-0])
                                         )
                                        )
                                       )
                                       (par
                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                        (null)
                                       )
                                      )
                                      (call %init_peer_id% ("worker-spell" "set_string") ["status" "install error"])
                                     )
                                    )
                                   )
                                   (par
                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["install" "exit"])
                                    (null)
                                   )
                                  )
                                  (call %init_peer_id% (spell_id "get_string") ["status"] status)
                                 )
                                 (par
                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                  (null)
                                 )
                                )
                                (new $array-inline-76
                                 (seq
                                  (seq
                                   (ap "Worker installation finished with status" $array-inline-76)
                                   (ap status.$.str $array-inline-76)
                                  )
                                  (canon %init_peer_id% $array-inline-76  #array-inline-76-0)
                                 )
                                )
                               )
                               (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-37)
                              )
                              (call %init_peer_id% ("debug" "stringify") [#array-inline-76-0] str-35)
                             )
                             (par
                              (call %init_peer_id% (spell_id-37 "list_push_string") ["logs" str-35])
                              (seq
                               (new $array-inline-77
                                (seq
                                 (seq
                                  (ap spell_id-37 $array-inline-77)
                                  (ap #array-inline-76-0 $array-inline-77)
                                 )
                                 (canon %init_peer_id% $array-inline-77  #array-inline-77-0)
                                )
                               )
                               (call %init_peer_id% ("run-console" "print") [#array-inline-77-0])
                              )
                             )
                            )
                            (par
                             (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                             (null)
                            )
                           )
                           (xor
                            (match status.$.str "install finished"
                             (xor
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (call %init_peer_id% ("peer" "timestamp_sec") [] now)
                                  (call %init_peer_id% (spell_id "get_u32") ["subnet_created"] created)
                                 )
                                 (call %init_peer_id% (spell_id "get_u32") ["worker_registered"] registered)
                                )
                                (xor
                                 (match created.$.success true
                                  (xor
                                   (xor
                                    (match registered.$.success true
                                     (xor
                                      (xor
                                       (seq
                                        (seq
                                         (call %init_peer_id% ("math" "sub") [now created.$.num] sub)
                                         (call %init_peer_id% ("cmp" "gt") [sub 43200] gt)
                                        )
                                        (match gt true
                                         (xor
                                          (seq
                                           (seq
                                            (seq
                                             (par
                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["createSubnetwork" "enter"])
                                              (null)
                                             )
                                             (new $subnetwork_id
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (call %init_peer_id% ("peer" "timestamp_sec") [] t)
                                                  (call -relay- ("op" "noop") [])
                                                 )
                                                 (xor
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (par
                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getInsecuredPeerId" "enter"])
                                                           (null)
                                                          )
                                                          (call -relay- ("insecure_sig" "get_peer_id") [] peer_id)
                                                         )
                                                         (par
                                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getInsecuredPeerId" "exit"])
                                                          (null)
                                                         )
                                                        )
                                                        (par
                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getKeyInsecuredSignature" "enter"])
                                                         (null)
                                                        )
                                                       )
                                                       (new $option-inline
                                                        (seq
                                                         (xor
                                                          (ap peer_id $option-inline)
                                                          (null)
                                                         )
                                                         (canon -relay- $option-inline  #option-inline-0)
                                                        )
                                                       )
                                                      )
                                                      (call -relay- ("registry" "get_key_bytes") [deal_id #option-inline-0 t [] ""] bytes)
                                                     )
                                                     (call -relay- ("insecure_sig" "sign") [bytes] result-1)
                                                    )
                                                    (par
                                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getKeyInsecuredSignature" "exit"])
                                                     (null)
                                                    )
                                                   )
                                                   (xor
                                                    (match result-1.$.success false
                                                     (ap result-1.$.error.[0] $error)
                                                    )
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (ap result-1.$.signature result-1_flat)
                                                              (call -relay- ("registry" "get_key_id") [deal_id peer_id] id)
                                                             )
                                                             (par
                                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "enter"])
                                                              (null)
                                                             )
                                                            )
                                                            (call -relay- ("op" "string_to_b58") [id] k)
                                                           )
                                                           (call -relay- ("kad" "neighborhood") [k [] []] nodes)
                                                          )
                                                          (par
                                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "exit"])
                                                           (null)
                                                          )
                                                         )
                                                         (xor
                                                          (par
                                                           (fold nodes n-0
                                                            (par
                                                             (seq
                                                              (xor
                                                               (xor
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (par
                                                                       (seq
                                                                        (call -relay- ("op" "noop") [])
                                                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["registerSubnetworkKey" "enter"])
                                                                       )
                                                                       (null)
                                                                      )
                                                                      (call n-0 ("peer" "timestamp_sec") [] t-0)
                                                                     )
                                                                     (call n-0 ("trust-graph" "get_weight") [peer_id t-0] weight)
                                                                    )
                                                                    (new $option-inline-1
                                                                     (seq
                                                                      (xor
                                                                       (ap peer_id $option-inline-1)
                                                                       (null)
                                                                      )
                                                                      (canon n-0 $option-inline-1  #option-inline-1-0)
                                                                     )
                                                                    )
                                                                   )
                                                                   (call n-0 ("registry" "register_key") [deal_id #option-inline-1-0 t [] "" result-1_flat.$.[0] weight t-0] result-2)
                                                                  )
                                                                  (par
                                                                   (seq
                                                                    (call -relay- ("op" "noop") [])
                                                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["registerSubnetworkKey" "exit"])
                                                                   )
                                                                   (null)
                                                                  )
                                                                 )
                                                                 (xor
                                                                  (match result-2.$.success true
                                                                   (ap true $successful)
                                                                  )
                                                                  (ap result-2.$.error $error)
                                                                 )
                                                                )
                                                                (call n-0 ("op" "noop") [])
                                                               )
                                                               (seq
                                                                (call -relay- ("op" "noop") [])
                                                                (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 12])
                                                               )
                                                              )
                                                              (call -relay- ("op" "noop") [])
                                                             )
                                                             (next n-0)
                                                            )
                                                            (never)
                                                           )
                                                           (null)
                                                          )
                                                          (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 13])
                                                         )
                                                        )
                                                        (par
                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "enter"])
                                                         (null)
                                                        )
                                                       )
                                                       (new $status-0
                                                        (new $result-3
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (par
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (par
                                                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "enter"])
                                                                   (null)
                                                                  )
                                                                  (call -relay- ("math" "sub") [1 1] sub-0)
                                                                 )
                                                                 (new $successful_test
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (call -relay- ("math" "add") [sub-0 1] successful_incr)
                                                                     (fold $successful successful_fold_var
                                                                      (seq
                                                                       (seq
                                                                        (ap successful_fold_var $successful_test)
                                                                        (canon -relay- $successful_test  #successful_iter_canon)
                                                                       )
                                                                       (xor
                                                                        (match #successful_iter_canon.length successful_incr
                                                                         (null)
                                                                        )
                                                                        (next successful_fold_var)
                                                                       )
                                                                      )
                                                                      (never)
                                                                     )
                                                                    )
                                                                    (canon -relay- $successful_test  #successful_result_canon)
                                                                   )
                                                                   (ap #successful_result_canon successful_gate)
                                                                  )
                                                                 )
                                                                )
                                                                (call -relay- ("math" "sub") [1 1] sub-1)
                                                               )
                                                               (ap "ok" $status-0)
                                                              )
                                                              (par
                                                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "exit"])
                                                               (null)
                                                              )
                                                             )
                                                             (call -relay- ("peer" "timeout") [6000 "timeout"] $status-0)
                                                            )
                                                            (new $status-0_test
                                                             (seq
                                                              (seq
                                                               (seq
                                                                (call -relay- ("math" "add") [0 1] status-0_incr)
                                                                (fold $status-0 status-0_fold_var
                                                                 (seq
                                                                  (seq
                                                                   (ap status-0_fold_var $status-0_test)
                                                                   (canon -relay- $status-0_test  #status-0_iter_canon)
                                                                  )
                                                                  (xor
                                                                   (match #status-0_iter_canon.length status-0_incr
                                                                    (null)
                                                                   )
                                                                   (next status-0_fold_var)
                                                                  )
                                                                 )
                                                                 (never)
                                                                )
                                                               )
                                                               (canon -relay- $status-0_test  #status-0_result_canon)
                                                              )
                                                              (ap #status-0_result_canon status-0_gate)
                                                             )
                                                            )
                                                           )
                                                           (xor
                                                            (match status-0_gate.$.[0] "ok"
                                                             (ap true $result-3)
                                                            )
                                                            (ap false $result-3)
                                                           )
                                                          )
                                                          (new $result-3_test
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (call -relay- ("math" "add") [0 1] result-3_incr)
                                                              (fold $result-3 result-3_fold_var
                                                               (seq
                                                                (seq
                                                                 (ap result-3_fold_var $result-3_test)
                                                                 (canon -relay- $result-3_test  #result-3_iter_canon)
                                                                )
                                                                (xor
                                                                 (match #result-3_iter_canon.length result-3_incr
                                                                  (null)
                                                                 )
                                                                 (next result-3_fold_var)
                                                                )
                                                               )
                                                               (never)
                                                              )
                                                             )
                                                             (canon -relay- $result-3_test  #result-3_result_canon)
                                                            )
                                                            (ap #result-3_result_canon result-3_gate)
                                                           )
                                                          )
                                                         )
                                                        )
                                                       )
                                                      )
                                                      (par
                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "exit"])
                                                       (null)
                                                      )
                                                     )
                                                     (xor
                                                      (match result-3_gate.$.[0] false
                                                       (ap "key wasn't created: timeout exceeded" $error)
                                                      )
                                                      (ap id $subnetwork_id)
                                                     )
                                                    )
                                                   )
                                                  )
                                                  (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 14])
                                                 )
                                                )
                                                (canon %init_peer_id% $subnetwork_id  #-subnetwork_id-fix-0)
                                               )
                                               (ap #-subnetwork_id-fix-0 -subnetwork_id-flat-0)
                                              )
                                             )
                                            )
                                            (par
                                             (call %init_peer_id% ("tracingSrv" "tracingEvent") ["createSubnetwork" "exit"])
                                             (null)
                                            )
                                           )
                                           (xor
                                            (mismatch -subnetwork_id-flat-0 []
                                             (xor
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (par
                                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                     (null)
                                                    )
                                                    (new $array-inline-78
                                                     (seq
                                                      (seq
                                                       (ap "Subnet created" $array-inline-78)
                                                       (ap -subnetwork_id-flat-0.$.[0] $array-inline-78)
                                                      )
                                                      (canon %init_peer_id% $array-inline-78  #array-inline-78-0)
                                                     )
                                                    )
                                                   )
                                                   (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-38)
                                                  )
                                                  (call %init_peer_id% ("debug" "stringify") [#array-inline-78-0] str-36)
                                                 )
                                                 (par
                                                  (call %init_peer_id% (spell_id-38 "list_push_string") ["logs" str-36])
                                                  (seq
                                                   (new $array-inline-79
                                                    (seq
                                                     (seq
                                                      (ap spell_id-38 $array-inline-79)
                                                      (ap #array-inline-78-0 $array-inline-79)
                                                     )
                                                     (canon %init_peer_id% $array-inline-79  #array-inline-79-0)
                                                    )
                                                   )
                                                   (call %init_peer_id% ("run-console" "print") [#array-inline-79-0])
                                                  )
                                                 )
                                                )
                                                (par
                                                 (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                                 (null)
                                                )
                                               )
                                               (ap -subnetwork_id-flat-0.$.[0] $subnet_id)
                                              )
                                              (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 15])
                                             )
                                            )
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (par
                                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                  (null)
                                                 )
                                                 (new $array-inline-80
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (ap "error creating subnetwork" $array-inline-80)
                                                     (canon %init_peer_id% $error  #push-to-stream-1667)
                                                    )
                                                    (ap #push-to-stream-1667 $array-inline-80)
                                                   )
                                                   (canon %init_peer_id% $array-inline-80  #array-inline-80-0)
                                                  )
                                                 )
                                                )
                                                (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-39)
                                               )
                                               (call %init_peer_id% ("debug" "stringify") [#array-inline-80-0] str-37)
                                              )
                                              (par
                                               (call %init_peer_id% (spell_id-39 "list_push_string") ["logs" str-37])
                                               (seq
                                                (new $array-inline-81
                                                 (seq
                                                  (seq
                                                   (ap spell_id-39 $array-inline-81)
                                                   (ap #array-inline-80-0 $array-inline-81)
                                                  )
                                                  (canon %init_peer_id% $array-inline-81  #array-inline-81-0)
                                                 )
                                                )
                                                (call %init_peer_id% ("run-console" "print") [#array-inline-81-0])
                                               )
                                              )
                                             )
                                             (par
                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                              (null)
                                             )
                                            )
                                           )
                                          )
                                          (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 16])
                                         )
                                        )
                                       )
                                       (xor
                                        (seq
                                         (seq
                                          (call %init_peer_id% ("math" "sub") [now registered.$.num] sub-2)
                                          (call %init_peer_id% ("cmp" "gt") [sub-2 43200] gt-0)
                                         )
                                         (match gt-0 true
                                          (xor
                                           (seq
                                            (call %init_peer_id% (spell_id "get_string") ["subnet_id"] sid)
                                            (xor
                                             (match sid.$.success true
                                              (ap sid.$.str $subnet_id)
                                             )
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (par
                                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                                   (null)
                                                  )
                                                  (new $array-inline-82
                                                   (seq
                                                    (seq
                                                     (ap "error reading subnet_id" $array-inline-82)
                                                     (ap sid $array-inline-82)
                                                    )
                                                    (canon %init_peer_id% $array-inline-82  #array-inline-82-0)
                                                   )
                                                  )
                                                 )
                                                 (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-40)
                                                )
                                                (call %init_peer_id% ("debug" "stringify") [#array-inline-82-0] str-38)
                                               )
                                               (par
                                                (call %init_peer_id% (spell_id-40 "list_push_string") ["logs" str-38])
                                                (seq
                                                 (new $array-inline-83
                                                  (seq
                                                   (seq
                                                    (ap spell_id-40 $array-inline-83)
                                                    (ap #array-inline-82-0 $array-inline-83)
                                                   )
                                                   (canon %init_peer_id% $array-inline-83  #array-inline-83-0)
                                                  )
                                                 )
                                                 (call %init_peer_id% ("run-console" "print") [#array-inline-83-0])
                                                )
                                               )
                                              )
                                              (par
                                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                               (null)
                                              )
                                             )
                                            )
                                           )
                                           (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 17])
                                          )
                                         )
                                        )
                                        (call %init_peer_id% ("op" "noop") [])
                                       )
                                      )
                                      (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 18])
                                     )
                                    )
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (par
                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                          (null)
                                         )
                                         (new $array-inline-84
                                          (seq
                                           (seq
                                            (ap "error reading worker_registered" $array-inline-84)
                                            (ap registered $array-inline-84)
                                           )
                                           (canon %init_peer_id% $array-inline-84  #array-inline-84-0)
                                          )
                                         )
                                        )
                                        (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-41)
                                       )
                                       (call %init_peer_id% ("debug" "stringify") [#array-inline-84-0] str-39)
                                      )
                                      (par
                                       (call %init_peer_id% (spell_id-41 "list_push_string") ["logs" str-39])
                                       (seq
                                        (new $array-inline-85
                                         (seq
                                          (seq
                                           (ap spell_id-41 $array-inline-85)
                                           (ap #array-inline-84-0 $array-inline-85)
                                          )
                                          (canon %init_peer_id% $array-inline-85  #array-inline-85-0)
                                         )
                                        )
                                        (call %init_peer_id% ("run-console" "print") [#array-inline-85-0])
                                       )
                                      )
                                     )
                                     (par
                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                      (null)
                                     )
                                    )
                                   )
                                   (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 19])
                                  )
                                 )
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (seq
                                      (par
                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                       (null)
                                      )
                                      (new $array-inline-86
                                       (seq
                                        (seq
                                         (ap "error reading subnet_created" $array-inline-86)
                                         (ap created $array-inline-86)
                                        )
                                        (canon %init_peer_id% $array-inline-86  #array-inline-86-0)
                                       )
                                      )
                                     )
                                     (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-42)
                                    )
                                    (call %init_peer_id% ("debug" "stringify") [#array-inline-86-0] str-40)
                                   )
                                   (par
                                    (call %init_peer_id% (spell_id-42 "list_push_string") ["logs" str-40])
                                    (seq
                                     (new $array-inline-87
                                      (seq
                                       (seq
                                        (ap spell_id-42 $array-inline-87)
                                        (ap #array-inline-86-0 $array-inline-87)
                                       )
                                       (canon %init_peer_id% $array-inline-87  #array-inline-87-0)
                                      )
                                     )
                                     (call %init_peer_id% ("run-console" "print") [#array-inline-87-0])
                                    )
                                   )
                                  )
                                  (par
                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                   (null)
                                  )
                                 )
                                )
                               )
                               (xor
                                (seq
                                 (canon %init_peer_id% $subnet_id  #subnet_id_canon)
                                 (mismatch #subnet_id_canon []
                                  (xor
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (new $subnet_id_test
                                         (seq
                                          (seq
                                           (seq
                                            (call %init_peer_id% ("math" "add") [0 1] subnet_id_incr)
                                            (fold $subnet_id subnet_id_fold_var
                                             (seq
                                              (seq
                                               (ap subnet_id_fold_var $subnet_id_test)
                                               (canon %init_peer_id% $subnet_id_test  #subnet_id_iter_canon)
                                              )
                                              (xor
                                               (match #subnet_id_iter_canon.length subnet_id_incr
                                                (null)
                                               )
                                               (next subnet_id_fold_var)
                                              )
                                             )
                                             (never)
                                            )
                                           )
                                           (canon %init_peer_id% $subnet_id_test  #subnet_id_result_canon)
                                          )
                                          (ap #subnet_id_result_canon subnet_id_gate)
                                         )
                                        )
                                        (call %init_peer_id% (spell_id "set_string") ["subnet_id" subnet_id_gate.$.[0]])
                                       )
                                       (call %init_peer_id% (spell_id "set_u32") ["subnet_created" now])
                                      )
                                      (call -relay- ("op" "noop") [])
                                     )
                                     (xor
                                      (seq
                                       (seq
                                        (seq
                                         (par
                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["registerWorker" "enter"])
                                          (null)
                                         )
                                         (new $subnet_id_test-0
                                          (seq
                                           (seq
                                            (seq
                                             (call -relay- ("math" "add") [0 1] subnet_id_incr-0)
                                             (fold $subnet_id subnet_id_fold_var-0
                                              (seq
                                               (seq
                                                (ap subnet_id_fold_var-0 $subnet_id_test-0)
                                                (canon -relay- $subnet_id_test-0  #subnet_id_iter_canon-0)
                                               )
                                               (xor
                                                (match #subnet_id_iter_canon-0.length subnet_id_incr-0
                                                 (null)
                                                )
                                                (next subnet_id_fold_var-0)
                                               )
                                              )
                                              (never)
                                             )
                                            )
                                            (canon -relay- $subnet_id_test-0  #subnet_id_result_canon-0)
                                           )
                                           (ap #subnet_id_result_canon-0 subnet_id_gate-0)
                                          )
                                         )
                                        )
                                        (new $success
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (par
                                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getWorkerRecordMetadata" "enter"])
                                               (null)
                                              )
                                              (new $error-1
                                               (new $result-4
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (call -relay- ("peer" "timestamp_sec") [] t-2)
                                                        (new $option-inline-2
                                                         (seq
                                                          (xor
                                                           (ap -relay- $option-inline-2)
                                                           (null)
                                                          )
                                                          (canon -relay- $option-inline-2  #option-inline-2-0)
                                                         )
                                                        )
                                                       )
                                                       (call -relay- ("registry" "get_record_metadata_bytes") [subnet_id_gate-0.$.[0] %init_peer_id% t-2 "" %init_peer_id% #option-inline-2-0 [] []] bytes-0)
                                                      )
                                                      (xor
                                                       (call %init_peer_id% ("sig" "sign") [bytes-0] sig_result-0)
                                                       (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 20])
                                                      )
                                                     )
                                                     (xor
                                                      (match sig_result-0.$.success true
                                                       (xor
                                                        (call -relay- ("registry" "create_record_metadata") [subnet_id_gate-0.$.[0] %init_peer_id% t-2 "" %init_peer_id% #option-inline-2-0 [] [] sig_result-0.$.signature.[0]] $result-4)
                                                        (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 21])
                                                       )
                                                      )
                                                      (ap sig_result-0.$.error.[0] $error-1)
                                                     )
                                                    )
                                                    (canon -relay- $result-4  #-result-fix-0)
                                                   )
                                                   (ap #-result-fix-0 -result-flat-0)
                                                  )
                                                  (canon -relay- $error-1  #-error-fix-1)
                                                 )
                                                 (ap #-error-fix-1 -error-flat-1)
                                                )
                                               )
                                              )
                                             )
                                             (par
                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getWorkerRecordMetadata" "exit"])
                                              (null)
                                             )
                                            )
                                            (xor
                                             (match -result-flat-0 []
                                              (seq
                                               (ap false $success)
                                               (ap -error-flat-1.$.[0] $error-0)
                                              )
                                             )
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (call -relay- ("peer" "timestamp_sec") [] t-1)
                                                 (par
                                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getWorkerRecordSignature" "enter"])
                                                  (null)
                                                 )
                                                )
                                                (new $signature-1
                                                 (seq
                                                  (seq
                                                   (call -relay- ("registry" "get_record_bytes") [-result-flat-0.$.[0] t-1] bytes-1)
                                                   (xor
                                                    (call %init_peer_id% ("sig" "sign") [bytes-1] $signature-1)
                                                    (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 22])
                                                   )
                                                  )
                                                  (new $signature-1_test
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (call -relay- ("math" "add") [0 1] signature-1_incr)
                                                      (fold $signature-1 signature-1_fold_var
                                                       (seq
                                                        (seq
                                                         (ap signature-1_fold_var $signature-1_test)
                                                         (canon -relay- $signature-1_test  #signature-1_iter_canon)
                                                        )
                                                        (xor
                                                         (match #signature-1_iter_canon.length signature-1_incr
                                                          (null)
                                                         )
                                                         (next signature-1_fold_var)
                                                        )
                                                       )
                                                       (never)
                                                      )
                                                     )
                                                     (canon -relay- $signature-1_test  #signature-1_result_canon)
                                                    )
                                                    (ap #signature-1_result_canon signature-1_gate)
                                                   )
                                                  )
                                                 )
                                                )
                                               )
                                               (par
                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getWorkerRecordSignature" "exit"])
                                                (null)
                                               )
                                              )
                                              (xor
                                               (match signature-1_gate.$.[0].success false
                                                (seq
                                                 (ap signature-1_gate.$.[0].error.[0] $error-0)
                                                 (ap false $success)
                                                )
                                               )
                                               (seq
                                                (seq
                                                 (seq
                                                  (par
                                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getResourceHelper" "enter"])
                                                   (null)
                                                  )
                                                  (new $resources
                                                   (new $successful-1
                                                    (new $result-5
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (par
                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "enter"])
                                                                (null)
                                                               )
                                                               (call -relay- ("op" "string_to_b58") [subnet_id_gate-0.$.[0]] k-0)
                                                              )
                                                              (call -relay- ("kad" "neighborhood") [k-0 [] []] nodes-2)
                                                             )
                                                             (par
                                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "exit"])
                                                              (null)
                                                             )
                                                            )
                                                            (par
                                                             (fold nodes-2 n-2-0
                                                              (par
                                                               (seq
                                                                (xor
                                                                 (xor
                                                                  (seq
                                                                   (call n-2-0 ("registry" "get_key_metadata") [subnet_id_gate-0.$.[0]] get_result)
                                                                   (xor
                                                                    (match get_result.$.success true
                                                                     (seq
                                                                      (ap get_result.$.key $resources)
                                                                      (ap true $successful-1)
                                                                     )
                                                                    )
                                                                    (seq
                                                                     (call n-2-0 ("op" "concat_strings") [get_result.$.error " on "] e-0)
                                                                     (call n-2-0 ("op" "concat_strings") [e-0 n-2-0] $error-2)
                                                                    )
                                                                   )
                                                                  )
                                                                  (call n-2-0 ("op" "noop") [])
                                                                 )
                                                                 (seq
                                                                  (call -relay- ("op" "noop") [])
                                                                  (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 23])
                                                                 )
                                                                )
                                                                (call -relay- ("op" "noop") [])
                                                               )
                                                               (next n-2-0)
                                                              )
                                                              (never)
                                                             )
                                                             (null)
                                                            )
                                                           )
                                                           (par
                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "enter"])
                                                            (null)
                                                           )
                                                          )
                                                          (new $status-1
                                                           (new $result-6
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (par
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (par
                                                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "enter"])
                                                                      (null)
                                                                     )
                                                                     (call -relay- ("math" "sub") [1 1] sub-3)
                                                                    )
                                                                    (new $successful-1_test
                                                                     (seq
                                                                      (seq
                                                                       (seq
                                                                        (call -relay- ("math" "add") [sub-3 1] successful-1_incr)
                                                                        (fold $successful-1 successful-1_fold_var
                                                                         (seq
                                                                          (seq
                                                                           (ap successful-1_fold_var $successful-1_test)
                                                                           (canon -relay- $successful-1_test  #successful-1_iter_canon)
                                                                          )
                                                                          (xor
                                                                           (match #successful-1_iter_canon.length successful-1_incr
                                                                            (null)
                                                                           )
                                                                           (next successful-1_fold_var)
                                                                          )
                                                                         )
                                                                         (never)
                                                                        )
                                                                       )
                                                                       (canon -relay- $successful-1_test  #successful-1_result_canon)
                                                                      )
                                                                      (ap #successful-1_result_canon successful-1_gate)
                                                                     )
                                                                    )
                                                                   )
                                                                   (call -relay- ("math" "sub") [1 1] sub-4)
                                                                  )
                                                                  (ap "ok" $status-1)
                                                                 )
                                                                 (par
                                                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "exit"])
                                                                  (null)
                                                                 )
                                                                )
                                                                (call -relay- ("peer" "timeout") [6000 "timeout"] $status-1)
                                                               )
                                                               (new $status-1_test
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (call -relay- ("math" "add") [0 1] status-1_incr)
                                                                   (fold $status-1 status-1_fold_var
                                                                    (seq
                                                                     (seq
                                                                      (ap status-1_fold_var $status-1_test)
                                                                      (canon -relay- $status-1_test  #status-1_iter_canon)
                                                                     )
                                                                     (xor
                                                                      (match #status-1_iter_canon.length status-1_incr
                                                                       (null)
                                                                      )
                                                                      (next status-1_fold_var)
                                                                     )
                                                                    )
                                                                    (never)
                                                                   )
                                                                  )
                                                                  (canon -relay- $status-1_test  #status-1_result_canon)
                                                                 )
                                                                 (ap #status-1_result_canon status-1_gate)
                                                                )
                                                               )
                                                              )
                                                              (xor
                                                               (match status-1_gate.$.[0] "ok"
                                                                (ap true $result-6)
                                                               )
                                                               (ap false $result-6)
                                                              )
                                                             )
                                                             (new $result-6_test
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (call -relay- ("math" "add") [0 1] result-6_incr)
                                                                 (fold $result-6 result-6_fold_var
                                                                  (seq
                                                                   (seq
                                                                    (ap result-6_fold_var $result-6_test)
                                                                    (canon -relay- $result-6_test  #result-6_iter_canon)
                                                                   )
                                                                   (xor
                                                                    (match #result-6_iter_canon.length result-6_incr
                                                                     (null)
                                                                    )
                                                                    (next result-6_fold_var)
                                                                   )
                                                                  )
                                                                  (never)
                                                                 )
                                                                )
                                                                (canon -relay- $result-6_test  #result-6_result_canon)
                                                               )
                                                               (ap #result-6_result_canon result-6_gate)
                                                              )
                                                             )
                                                            )
                                                           )
                                                          )
                                                         )
                                                         (par
                                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "exit"])
                                                          (null)
                                                         )
                                                        )
                                                        (xor
                                                         (match result-6_gate.$.[0] false
                                                          (ap "resource not found: timeout exceeded" $error-2)
                                                         )
                                                         (seq
                                                          (seq
                                                           (canon -relay- $resources  #resources_canon)
                                                           (call -relay- ("registry" "merge_keys") [#resources_canon] merge_result)
                                                          )
                                                          (xor
                                                           (match merge_result.$.success true
                                                            (ap merge_result.$.key $result-5)
                                                           )
                                                           (ap merge_result.$.error $error-2)
                                                          )
                                                         )
                                                        )
                                                       )
                                                       (canon -relay- $result-5  #-result-fix-0-0)
                                                      )
                                                      (ap #-result-fix-0-0 -result-flat-0-0)
                                                     )
                                                    )
                                                   )
                                                  )
                                                 )
                                                 (par
                                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getResourceHelper" "exit"])
                                                  (null)
                                                 )
                                                )
                                                (xor
                                                 (match -result-flat-0-0 []
                                                  (xor
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (par
                                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["appendErrors" "enter"])
                                                        (null)
                                                       )
                                                       (canon -relay- $error-2  #error-2_canon)
                                                      )
                                                      (fold #error-2_canon e-1-0
                                                       (seq
                                                        (ap e-1-0 $error-0)
                                                        (next e-1-0)
                                                       )
                                                      )
                                                     )
                                                     (par
                                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["appendErrors" "exit"])
                                                      (null)
                                                     )
                                                    )
                                                    (ap false $success)
                                                   )
                                                   (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 24])
                                                  )
                                                 )
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (par
                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["republishKey" "enter"])
                                                       (null)
                                                      )
                                                      (call -relay- ("peer" "timestamp_sec") [] t-3)
                                                     )
                                                     (call -relay- ("trust-graph" "get_weight") [-result-flat-0-0.$.[0].owner_peer_id t-3] weight-0)
                                                    )
                                                    (call -relay- ("registry" "republish_key") [-result-flat-0-0.$.[0] weight-0 t-3] result-7)
                                                   )
                                                   (par
                                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["republishKey" "exit"])
                                                    (null)
                                                   )
                                                  )
                                                  (xor
                                                   (match result-7.$.success false
                                                    (seq
                                                     (ap result-7.$.error $error-0)
                                                     (ap false $success)
                                                    )
                                                   )
                                                   (seq
                                                    (seq
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (par
                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["putRecord" "enter"])
                                                         (null)
                                                        )
                                                        (call -relay- ("peer" "timestamp_sec") [] t-4)
                                                       )
                                                       (call -relay- ("trust-graph" "get_weight") [-result-flat-0.$.[0].issued_by t-4] weight-1)
                                                      )
                                                      (call -relay- ("registry" "put_record") [-result-flat-0.$.[0] t-1 signature-1_gate.$.[0].signature.[0] weight-1 t-4] result-8)
                                                     )
                                                     (par
                                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["putRecord" "exit"])
                                                      (null)
                                                     )
                                                    )
                                                    (xor
                                                     (match result-8.$.success false
                                                      (seq
                                                       (ap result-8.$.error $error-0)
                                                       (ap false $success)
                                                      )
                                                     )
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (seq
                                                         (seq
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (par
                                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "enter"])
                                                              (null)
                                                             )
                                                             (call -relay- ("op" "string_to_b58") [subnet_id_gate-0.$.[0]] k-1)
                                                            )
                                                            (call -relay- ("kad" "neighborhood") [k-1 [] []] nodes-3)
                                                           )
                                                           (par
                                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "exit"])
                                                            (null)
                                                           )
                                                          )
                                                          (par
                                                           (fold nodes-3 n-1-0
                                                            (par
                                                             (seq
                                                              (xor
                                                               (xor
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (par
                                                                      (seq
                                                                       (call -relay- ("op" "noop") [])
                                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["republishKey" "enter"])
                                                                      )
                                                                      (null)
                                                                     )
                                                                     (call n-1-0 ("peer" "timestamp_sec") [] t-5)
                                                                    )
                                                                    (call n-1-0 ("trust-graph" "get_weight") [-result-flat-0-0.$.[0].owner_peer_id t-5] weight-2)
                                                                   )
                                                                   (call n-1-0 ("registry" "republish_key") [-result-flat-0-0.$.[0] weight-2 t-5] result-9)
                                                                  )
                                                                  (par
                                                                   (seq
                                                                    (call -relay- ("op" "noop") [])
                                                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["republishKey" "exit"])
                                                                   )
                                                                   (null)
                                                                  )
                                                                 )
                                                                 (xor
                                                                  (match result-9.$.success false
                                                                   (ap result-9.$.error $error-0)
                                                                  )
                                                                  (seq
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (seq
                                                                       (par
                                                                        (seq
                                                                         (call -relay- ("op" "noop") [])
                                                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["putRecord" "enter"])
                                                                        )
                                                                        (null)
                                                                       )
                                                                       (call n-1-0 ("peer" "timestamp_sec") [] t-6)
                                                                      )
                                                                      (call n-1-0 ("trust-graph" "get_weight") [-result-flat-0.$.[0].issued_by t-6] weight-3)
                                                                     )
                                                                     (call n-1-0 ("registry" "put_record") [-result-flat-0.$.[0] t-1 signature-1_gate.$.[0].signature.[0] weight-3 t-6] result-10)
                                                                    )
                                                                    (par
                                                                     (seq
                                                                      (call -relay- ("op" "noop") [])
                                                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["putRecord" "exit"])
                                                                     )
                                                                     (null)
                                                                    )
                                                                   )
                                                                   (xor
                                                                    (match result-10.$.success true
                                                                     (ap true $successful-0)
                                                                    )
                                                                    (ap result-10.$.error $error-0)
                                                                   )
                                                                  )
                                                                 )
                                                                )
                                                                (call n-1-0 ("op" "noop") [])
                                                               )
                                                               (seq
                                                                (call -relay- ("op" "noop") [])
                                                                (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 25])
                                                               )
                                                              )
                                                              (call -relay- ("op" "noop") [])
                                                             )
                                                             (next n-1-0)
                                                            )
                                                            (never)
                                                           )
                                                           (null)
                                                          )
                                                         )
                                                         (par
                                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "enter"])
                                                          (null)
                                                         )
                                                        )
                                                        (new $status-2
                                                         (new $result-11
                                                          (seq
                                                           (seq
                                                            (seq
                                                             (par
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (seq
                                                                  (seq
                                                                   (par
                                                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "enter"])
                                                                    (null)
                                                                   )
                                                                   (call -relay- ("math" "sub") [1 1] sub-5)
                                                                  )
                                                                  (new $successful-0_test
                                                                   (seq
                                                                    (seq
                                                                     (seq
                                                                      (call -relay- ("math" "add") [sub-5 1] successful-0_incr)
                                                                      (fold $successful-0 successful-0_fold_var
                                                                       (seq
                                                                        (seq
                                                                         (ap successful-0_fold_var $successful-0_test)
                                                                         (canon -relay- $successful-0_test  #successful-0_iter_canon)
                                                                        )
                                                                        (xor
                                                                         (match #successful-0_iter_canon.length successful-0_incr
                                                                          (null)
                                                                         )
                                                                         (next successful-0_fold_var)
                                                                        )
                                                                       )
                                                                       (never)
                                                                      )
                                                                     )
                                                                     (canon -relay- $successful-0_test  #successful-0_result_canon)
                                                                    )
                                                                    (ap #successful-0_result_canon successful-0_gate)
                                                                   )
                                                                  )
                                                                 )
                                                                 (call -relay- ("math" "sub") [1 1] sub-6)
                                                                )
                                                                (ap "ok" $status-2)
                                                               )
                                                               (par
                                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "exit"])
                                                                (null)
                                                               )
                                                              )
                                                              (call -relay- ("peer" "timeout") [6000 "timeout"] $status-2)
                                                             )
                                                             (new $status-2_test
                                                              (seq
                                                               (seq
                                                                (seq
                                                                 (call -relay- ("math" "add") [0 1] status-2_incr)
                                                                 (fold $status-2 status-2_fold_var
                                                                  (seq
                                                                   (seq
                                                                    (ap status-2_fold_var $status-2_test)
                                                                    (canon -relay- $status-2_test  #status-2_iter_canon)
                                                                   )
                                                                   (xor
                                                                    (match #status-2_iter_canon.length status-2_incr
                                                                     (null)
                                                                    )
                                                                    (next status-2_fold_var)
                                                                   )
                                                                  )
                                                                  (never)
                                                                 )
                                                                )
                                                                (canon -relay- $status-2_test  #status-2_result_canon)
                                                               )
                                                               (ap #status-2_result_canon status-2_gate)
                                                              )
                                                             )
                                                            )
                                                            (xor
                                                             (match status-2_gate.$.[0] "ok"
                                                              (ap true $result-11)
                                                             )
                                                             (ap false $result-11)
                                                            )
                                                           )
                                                           (new $result-11_test
                                                            (seq
                                                             (seq
                                                              (seq
                                                               (call -relay- ("math" "add") [0 1] result-11_incr)
                                                               (fold $result-11 result-11_fold_var
                                                                (seq
                                                                 (seq
                                                                  (ap result-11_fold_var $result-11_test)
                                                                  (canon -relay- $result-11_test  #result-11_iter_canon)
                                                                 )
                                                                 (xor
                                                                  (match #result-11_iter_canon.length result-11_incr
                                                                   (null)
                                                                  )
                                                                  (next result-11_fold_var)
                                                                 )
                                                                )
                                                                (never)
                                                               )
                                                              )
                                                              (canon -relay- $result-11_test  #result-11_result_canon)
                                                             )
                                                             (ap #result-11_result_canon result-11_gate)
                                                            )
                                                           )
                                                          )
                                                         )
                                                        )
                                                       )
                                                       (ap result-11_gate.$.[0] $success)
                                                      )
                                                      (par
                                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "exit"])
                                                       (null)
                                                      )
                                                     )
                                                    )
                                                   )
                                                  )
                                                 )
                                                )
                                               )
                                              )
                                             )
                                            )
                                           )
                                           (new $success_test
                                            (seq
                                             (seq
                                              (seq
                                               (call -relay- ("math" "add") [0 1] success_incr)
                                               (fold $success success_fold_var
                                                (seq
                                                 (seq
                                                  (ap success_fold_var $success_test)
                                                  (canon -relay- $success_test  #success_iter_canon)
                                                 )
                                                 (xor
                                                  (match #success_iter_canon.length success_incr
                                                   (null)
                                                  )
                                                  (next success_fold_var)
                                                 )
                                                )
                                                (never)
                                               )
                                              )
                                              (canon -relay- $success_test  #success_result_canon)
                                             )
                                             (ap #success_result_canon success_gate)
                                            )
                                           )
                                          )
                                          (xor
                                           (match success_gate.$.[0] false
                                            (ap "worker hasn't registered: timeout exceeded" $error-0)
                                           )
                                           (call -relay- ("op" "noop") [])
                                          )
                                         )
                                        )
                                       )
                                       (par
                                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["registerWorker" "exit"])
                                        (null)
                                       )
                                      )
                                      (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 26])
                                     )
                                    )
                                    (xor
                                     (match success_gate.$.[0] true
                                      (xor
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (call %init_peer_id% (spell_id "set_u32") ["worker_registered" now])
                                             (par
                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                              (null)
                                             )
                                            )
                                            (new $array-inline-88
                                             (seq
                                              (seq
                                               (ap "worker successfully registered in registry" $array-inline-88)
                                               (ap success_gate.$.[0] $array-inline-88)
                                              )
                                              (canon %init_peer_id% $array-inline-88  #array-inline-88-0)
                                             )
                                            )
                                           )
                                           (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-43)
                                          )
                                          (call %init_peer_id% ("debug" "stringify") [#array-inline-88-0] str-41)
                                         )
                                         (par
                                          (call %init_peer_id% (spell_id-43 "list_push_string") ["logs" str-41])
                                          (seq
                                           (new $array-inline-89
                                            (seq
                                             (seq
                                              (ap spell_id-43 $array-inline-89)
                                              (ap #array-inline-88-0 $array-inline-89)
                                             )
                                             (canon %init_peer_id% $array-inline-89  #array-inline-89-0)
                                            )
                                           )
                                           (call %init_peer_id% ("run-console" "print") [#array-inline-89-0])
                                          )
                                         )
                                        )
                                        (par
                                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                         (null)
                                        )
                                       )
                                       (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 27])
                                      )
                                     )
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (par
                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "enter"])
                                           (null)
                                          )
                                          (new $array-inline-90
                                           (seq
                                            (seq
                                             (seq
                                              (ap "error registering worker" $array-inline-90)
                                              (canon %init_peer_id% $error-0  #push-to-stream-2234)
                                             )
                                             (ap #push-to-stream-2234 $array-inline-90)
                                            )
                                            (canon %init_peer_id% $array-inline-90  #array-inline-90-0)
                                           )
                                          )
                                         )
                                         (call %init_peer_id% ("getDataSrv" "spell_id") [] spell_id-44)
                                        )
                                        (call %init_peer_id% ("debug" "stringify") [#array-inline-90-0] str-42)
                                       )
                                       (par
                                        (call %init_peer_id% (spell_id-44 "list_push_string") ["logs" str-42])
                                        (seq
                                         (new $array-inline-91
                                          (seq
                                           (seq
                                            (ap spell_id-44 $array-inline-91)
                                            (ap #array-inline-90-0 $array-inline-91)
                                           )
                                           (canon %init_peer_id% $array-inline-91  #array-inline-91-0)
                                          )
                                         )
                                         (call %init_peer_id% ("run-console" "print") [#array-inline-91-0])
                                        )
                                       )
                                      )
                                      (par
                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["log" "exit"])
                                       (null)
                                      )
                                     )
                                    )
                                   )
                                   (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 28])
                                  )
                                 )
                                )
                                (call %init_peer_id% ("op" "noop") [])
                               )
                              )
                              (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 29])
                             )
                            )
                            (call %init_peer_id% ("op" "noop") [])
                           )
                          )
                         )
                        )
                       )
                      )
                      (par
                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["deal_install" "exit"])
                       (null)
                      )
                     )
                     (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 30])
                    )
    `
 

export function deal_install(
    ipfs: string,
    worker_def_cid: string,
    deal_id: string,
    config?: {ttl?: number}
): Promise<void>;

export function deal_install(
    peer: IFluenceClient$$,
    ipfs: string,
    worker_def_cid: string,
    deal_id: string,
    config?: {ttl?: number}
): Promise<void>;

export function deal_install(...args: any) {


    return callFunction$$(
        args,
        {
    "functionName" : "deal_install",
    "arrow" : {
        "tag" : "arrow",
        "domain" : {
            "tag" : "labeledProduct",
            "fields" : {
                "ipfs" : {
                    "tag" : "scalar",
                    "name" : "string"
                },
                "worker_def_cid" : {
                    "tag" : "scalar",
                    "name" : "string"
                },
                "deal_id" : {
                    "tag" : "scalar",
                    "name" : "string"
                }
            }
        },
        "codomain" : {
            "tag" : "nil"
        }
    },
    "names" : {
        "relay" : "-relay-",
        "getDataSrv" : "getDataSrv",
        "callbackSrv" : "callbackSrv",
        "responseSrv" : "callbackSrv",
        "responseFnName" : "response",
        "errorHandlingSrv" : "errorHandlingSrv",
        "errorFnName" : "error"
    }
},
        deal_install_script
    )
}

export const resolve_workers_script = `
                    (xor
                     (seq
                      (seq
                       (seq
                        (seq
                         (call %init_peer_id% ("getDataSrv" "-relay-") [] -relay-)
                         (call %init_peer_id% ("getDataSrv" "deal_id") [] deal_id)
                        )
                        (par
                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["resolve_workers" "enter"])
                         (null)
                        )
                       )
                       (new $errors
                        (seq
                         (seq
                          (seq
                           (seq
                            (seq
                             (seq
                              (call -relay- ("op" "noop") [])
                              (xor
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (par
                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getInsecuredPeerId" "enter"])
                                      (null)
                                     )
                                     (call -relay- ("insecure_sig" "get_peer_id") [] peer_id)
                                    )
                                    (par
                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getInsecuredPeerId" "exit"])
                                     (null)
                                    )
                                   )
                                   (call -relay- ("registry" "get_key_id") [deal_id peer_id] id)
                                  )
                                  (par
                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["resolveResource" "enter"])
                                   (null)
                                  )
                                 )
                                 (new $records
                                  (new $successful
                                   (new $result
                                    (seq
                                     (seq
                                      (xor
                                       (seq
                                        (seq
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (seq
                                               (par
                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "enter"])
                                                (null)
                                               )
                                               (call -relay- ("op" "string_to_b58") [id] k)
                                              )
                                              (call -relay- ("kad" "neighborhood") [k [] []] nodes)
                                             )
                                             (par
                                              (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "exit"])
                                              (null)
                                             )
                                            )
                                            (par
                                             (fold nodes n-0
                                              (par
                                               (seq
                                                (xor
                                                 (xor
                                                  (seq
                                                   (seq
                                                    (call n-0 ("peer" "timestamp_sec") [] t)
                                                    (call n-0 ("registry" "get_records") [id t] get_result)
                                                   )
                                                   (xor
                                                    (match get_result.$.success true
                                                     (seq
                                                      (ap get_result.$.result $records)
                                                      (ap true $successful)
                                                     )
                                                    )
                                                    (ap get_result.$.error $error)
                                                   )
                                                  )
                                                  (call n-0 ("op" "noop") [])
                                                 )
                                                 (seq
                                                  (call -relay- ("op" "noop") [])
                                                  (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 1])
                                                 )
                                                )
                                                (call -relay- ("op" "noop") [])
                                               )
                                               (next n-0)
                                              )
                                              (never)
                                             )
                                             (null)
                                            )
                                           )
                                           (par
                                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "enter"])
                                            (null)
                                           )
                                          )
                                          (new $status
                                           (new $result-0
                                            (seq
                                             (seq
                                              (seq
                                               (par
                                                (seq
                                                 (seq
                                                  (seq
                                                   (seq
                                                    (seq
                                                     (par
                                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "enter"])
                                                      (null)
                                                     )
                                                     (call -relay- ("math" "sub") [1 1] sub)
                                                    )
                                                    (new $successful_test
                                                     (seq
                                                      (seq
                                                       (seq
                                                        (call -relay- ("math" "add") [sub 1] successful_incr)
                                                        (fold $successful successful_fold_var
                                                         (seq
                                                          (seq
                                                           (ap successful_fold_var $successful_test)
                                                           (canon -relay- $successful_test  #successful_iter_canon)
                                                          )
                                                          (xor
                                                           (match #successful_iter_canon.length successful_incr
                                                            (null)
                                                           )
                                                           (next successful_fold_var)
                                                          )
                                                         )
                                                         (never)
                                                        )
                                                       )
                                                       (canon -relay- $successful_test  #successful_result_canon)
                                                      )
                                                      (ap #successful_result_canon successful_gate)
                                                     )
                                                    )
                                                   )
                                                   (call -relay- ("math" "sub") [1 1] sub-0)
                                                  )
                                                  (ap "ok" $status)
                                                 )
                                                 (par
                                                  (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "exit"])
                                                  (null)
                                                 )
                                                )
                                                (call -relay- ("peer" "timeout") [6000 "timeout"] $status)
                                               )
                                               (new $status_test
                                                (seq
                                                 (seq
                                                  (seq
                                                   (call -relay- ("math" "add") [0 1] status_incr)
                                                   (fold $status status_fold_var
                                                    (seq
                                                     (seq
                                                      (ap status_fold_var $status_test)
                                                      (canon -relay- $status_test  #status_iter_canon)
                                                     )
                                                     (xor
                                                      (match #status_iter_canon.length status_incr
                                                       (null)
                                                      )
                                                      (next status_fold_var)
                                                     )
                                                    )
                                                    (never)
                                                   )
                                                  )
                                                  (canon -relay- $status_test  #status_result_canon)
                                                 )
                                                 (ap #status_result_canon status_gate)
                                                )
                                               )
                                              )
                                              (xor
                                               (match status_gate.$.[0] "ok"
                                                (ap true $result-0)
                                               )
                                               (ap false $result-0)
                                              )
                                             )
                                             (new $result-0_test
                                              (seq
                                               (seq
                                                (seq
                                                 (call -relay- ("math" "add") [0 1] result-0_incr)
                                                 (fold $result-0 result-0_fold_var
                                                  (seq
                                                   (seq
                                                    (ap result-0_fold_var $result-0_test)
                                                    (canon -relay- $result-0_test  #result-0_iter_canon)
                                                   )
                                                   (xor
                                                    (match #result-0_iter_canon.length result-0_incr
                                                     (null)
                                                    )
                                                    (next result-0_fold_var)
                                                   )
                                                  )
                                                  (never)
                                                 )
                                                )
                                                (canon -relay- $result-0_test  #result-0_result_canon)
                                               )
                                               (ap #result-0_result_canon result-0_gate)
                                              )
                                             )
                                            )
                                           )
                                          )
                                         )
                                         (par
                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "exit"])
                                          (null)
                                         )
                                        )
                                        (xor
                                         (match result-0_gate.$.[0] false
                                          (ap "timeout exceeded" $error)
                                         )
                                         (seq
                                          (seq
                                           (canon -relay- $records  #records_canon)
                                           (call -relay- ("registry" "merge") [#records_canon] merged)
                                          )
                                          (xor
                                           (match merged.$.success false
                                            (ap merged.$.error $error)
                                           )
                                           (ap merged.$.result $result)
                                          )
                                         )
                                        )
                                       )
                                       (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 2])
                                      )
                                      (canon -relay- $result  #-result-fix-0)
                                     )
                                     (ap #-result-fix-0 -result-flat-0)
                                    )
                                   )
                                  )
                                 )
                                )
                                (par
                                 (call %init_peer_id% ("tracingSrv" "tracingEvent") ["resolveResource" "exit"])
                                 (null)
                                )
                               )
                               (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 3])
                              )
                             )
                             (call %init_peer_id% ("run-console" "print") ["records:"])
                            )
                            (fold -result-flat-0.$.[0] r-0
                             (seq
                              (seq
                               (seq
                                (ap r-0.$.metadata r-0_flat)
                                (call %init_peer_id% ("json" "puts") [r-0.$.metadata "issuer_signature" []] r-0_obj_copy)
                               )
                               (call %init_peer_id% ("run-console" "print") [r-0_obj_copy])
                              )
                              (next r-0)
                             )
                            )
                           )
                           (call %init_peer_id% ("run-console" "print") ["errors:"])
                          )
                          (canon %init_peer_id% $error  #error_canon)
                         )
                         (call %init_peer_id% ("run-console" "print") [#error_canon])
                        )
                       )
                      )
                      (par
                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["resolve_workers" "exit"])
                       (null)
                      )
                     )
                     (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 4])
                    )
    `
 

export function resolve_workers(
    deal_id: string,
    config?: {ttl?: number}
): Promise<void>;

export function resolve_workers(
    peer: IFluenceClient$$,
    deal_id: string,
    config?: {ttl?: number}
): Promise<void>;

export function resolve_workers(...args: any) {


    return callFunction$$(
        args,
        {
    "functionName" : "resolve_workers",
    "arrow" : {
        "tag" : "arrow",
        "domain" : {
            "tag" : "labeledProduct",
            "fields" : {
                "deal_id" : {
                    "tag" : "scalar",
                    "name" : "string"
                }
            }
        },
        "codomain" : {
            "tag" : "nil"
        }
    },
    "names" : {
        "relay" : "-relay-",
        "getDataSrv" : "getDataSrv",
        "callbackSrv" : "callbackSrv",
        "responseSrv" : "callbackSrv",
        "responseFnName" : "response",
        "errorHandlingSrv" : "errorHandlingSrv",
        "errorFnName" : "error"
    }
},
        resolve_workers_script
    )
}

export const create_sub_script = `
                    (xor
                     (seq
                      (seq
                       (seq
                        (seq
                         (seq
                          (seq
                           (seq
                            (call %init_peer_id% ("getDataSrv" "-relay-") [] -relay-)
                            (call %init_peer_id% ("getDataSrv" "deal_id") [] deal_id)
                           )
                           (par
                            (call %init_peer_id% ("tracingSrv" "tracingEvent") ["create_sub" "enter"])
                            (null)
                           )
                          )
                          (par
                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["createSubnetwork" "enter"])
                           (null)
                          )
                         )
                         (new $subnetwork_id
                          (seq
                           (seq
                            (seq
                             (seq
                              (call %init_peer_id% ("peer" "timestamp_sec") [] t)
                              (call -relay- ("op" "noop") [])
                             )
                             (xor
                              (seq
                               (seq
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (seq
                                      (par
                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getInsecuredPeerId" "enter"])
                                       (null)
                                      )
                                      (call -relay- ("insecure_sig" "get_peer_id") [] peer_id)
                                     )
                                     (par
                                      (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getInsecuredPeerId" "exit"])
                                      (null)
                                     )
                                    )
                                    (par
                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getKeyInsecuredSignature" "enter"])
                                     (null)
                                    )
                                   )
                                   (new $option-inline
                                    (seq
                                     (xor
                                      (ap peer_id $option-inline)
                                      (null)
                                     )
                                     (canon -relay- $option-inline  #option-inline-0)
                                    )
                                   )
                                  )
                                  (call -relay- ("registry" "get_key_bytes") [deal_id #option-inline-0 t [] ""] bytes)
                                 )
                                 (call -relay- ("insecure_sig" "sign") [bytes] result)
                                )
                                (par
                                 (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getKeyInsecuredSignature" "exit"])
                                 (null)
                                )
                               )
                               (xor
                                (match result.$.success false
                                 (ap result.$.error.[0] $error)
                                )
                                (seq
                                 (seq
                                  (seq
                                   (seq
                                    (seq
                                     (seq
                                      (seq
                                       (seq
                                        (seq
                                         (seq
                                          (ap result.$.signature result_flat)
                                          (call -relay- ("registry" "get_key_id") [deal_id peer_id] id)
                                         )
                                         (par
                                          (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "enter"])
                                          (null)
                                         )
                                        )
                                        (call -relay- ("op" "string_to_b58") [id] k)
                                       )
                                       (call -relay- ("kad" "neighborhood") [k [] []] nodes)
                                      )
                                      (par
                                       (call %init_peer_id% ("tracingSrv" "tracingEvent") ["getNeighbors" "exit"])
                                       (null)
                                      )
                                     )
                                     (xor
                                      (par
                                       (fold nodes n-0
                                        (par
                                         (seq
                                          (xor
                                           (xor
                                            (seq
                                             (seq
                                              (seq
                                               (seq
                                                (seq
                                                 (seq
                                                  (par
                                                   (seq
                                                    (call -relay- ("op" "noop") [])
                                                    (call %init_peer_id% ("tracingSrv" "tracingEvent") ["registerSubnetworkKey" "enter"])
                                                   )
                                                   (null)
                                                  )
                                                  (call n-0 ("peer" "timestamp_sec") [] t-0)
                                                 )
                                                 (call n-0 ("trust-graph" "get_weight") [peer_id t-0] weight)
                                                )
                                                (new $option-inline-1
                                                 (seq
                                                  (xor
                                                   (ap peer_id $option-inline-1)
                                                   (null)
                                                  )
                                                  (canon n-0 $option-inline-1  #option-inline-1-0)
                                                 )
                                                )
                                               )
                                               (call n-0 ("registry" "register_key") [deal_id #option-inline-1-0 t [] "" result_flat.$.[0] weight t-0] result-0)
                                              )
                                              (par
                                               (seq
                                                (call -relay- ("op" "noop") [])
                                                (call %init_peer_id% ("tracingSrv" "tracingEvent") ["registerSubnetworkKey" "exit"])
                                               )
                                               (null)
                                              )
                                             )
                                             (xor
                                              (match result-0.$.success true
                                               (ap true $successful)
                                              )
                                              (ap result-0.$.error $error)
                                             )
                                            )
                                            (call n-0 ("op" "noop") [])
                                           )
                                           (seq
                                            (call -relay- ("op" "noop") [])
                                            (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 1])
                                           )
                                          )
                                          (call -relay- ("op" "noop") [])
                                         )
                                         (next n-0)
                                        )
                                        (never)
                                       )
                                       (null)
                                      )
                                      (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 2])
                                     )
                                    )
                                    (par
                                     (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "enter"])
                                     (null)
                                    )
                                   )
                                   (new $status
                                    (new $result-1
                                     (seq
                                      (seq
                                       (seq
                                        (par
                                         (seq
                                          (seq
                                           (seq
                                            (seq
                                             (seq
                                              (par
                                               (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "enter"])
                                               (null)
                                              )
                                              (call -relay- ("math" "sub") [1 1] sub)
                                             )
                                             (new $successful_test
                                              (seq
                                               (seq
                                                (seq
                                                 (call -relay- ("math" "add") [sub 1] successful_incr)
                                                 (fold $successful successful_fold_var
                                                  (seq
                                                   (seq
                                                    (ap successful_fold_var $successful_test)
                                                    (canon -relay- $successful_test  #successful_iter_canon)
                                                   )
                                                   (xor
                                                    (match #successful_iter_canon.length successful_incr
                                                     (null)
                                                    )
                                                    (next successful_fold_var)
                                                   )
                                                  )
                                                  (never)
                                                 )
                                                )
                                                (canon -relay- $successful_test  #successful_result_canon)
                                               )
                                               (ap #successful_result_canon successful_gate)
                                              )
                                             )
                                            )
                                            (call -relay- ("math" "sub") [1 1] sub-0)
                                           )
                                           (ap "ok" $status)
                                          )
                                          (par
                                           (call %init_peer_id% ("tracingSrv" "tracingEvent") ["waiting" "exit"])
                                           (null)
                                          )
                                         )
                                         (call -relay- ("peer" "timeout") [6000 "timeout"] $status)
                                        )
                                        (new $status_test
                                         (seq
                                          (seq
                                           (seq
                                            (call -relay- ("math" "add") [0 1] status_incr)
                                            (fold $status status_fold_var
                                             (seq
                                              (seq
                                               (ap status_fold_var $status_test)
                                               (canon -relay- $status_test  #status_iter_canon)
                                              )
                                              (xor
                                               (match #status_iter_canon.length status_incr
                                                (null)
                                               )
                                               (next status_fold_var)
                                              )
                                             )
                                             (never)
                                            )
                                           )
                                           (canon -relay- $status_test  #status_result_canon)
                                          )
                                          (ap #status_result_canon status_gate)
                                         )
                                        )
                                       )
                                       (xor
                                        (match status_gate.$.[0] "ok"
                                         (ap true $result-1)
                                        )
                                        (ap false $result-1)
                                       )
                                      )
                                      (new $result-1_test
                                       (seq
                                        (seq
                                         (seq
                                          (call -relay- ("math" "add") [0 1] result-1_incr)
                                          (fold $result-1 result-1_fold_var
                                           (seq
                                            (seq
                                             (ap result-1_fold_var $result-1_test)
                                             (canon -relay- $result-1_test  #result-1_iter_canon)
                                            )
                                            (xor
                                             (match #result-1_iter_canon.length result-1_incr
                                              (null)
                                             )
                                             (next result-1_fold_var)
                                            )
                                           )
                                           (never)
                                          )
                                         )
                                         (canon -relay- $result-1_test  #result-1_result_canon)
                                        )
                                        (ap #result-1_result_canon result-1_gate)
                                       )
                                      )
                                     )
                                    )
                                   )
                                  )
                                  (par
                                   (call %init_peer_id% ("tracingSrv" "tracingEvent") ["wait" "exit"])
                                   (null)
                                  )
                                 )
                                 (xor
                                  (match result-1_gate.$.[0] false
                                   (ap "key wasn't created: timeout exceeded" $error)
                                  )
                                  (ap id $subnetwork_id)
                                 )
                                )
                               )
                              )
                              (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 3])
                             )
                            )
                            (canon %init_peer_id% $subnetwork_id  #-subnetwork_id-fix-0)
                           )
                           (ap #-subnetwork_id-fix-0 -subnetwork_id-flat-0)
                          )
                         )
                        )
                        (par
                         (call %init_peer_id% ("tracingSrv" "tracingEvent") ["createSubnetwork" "exit"])
                         (null)
                        )
                       )
                       (par
                        (call %init_peer_id% ("tracingSrv" "tracingEvent") ["create_sub" "exit"])
                        (null)
                       )
                      )
                      (xor
                       (seq
                        (canon %init_peer_id% $error  #error_canon)
                        (call %init_peer_id% ("callbackSrv" "response") [-subnetwork_id-flat-0 #error_canon])
                       )
                       (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 4])
                      )
                     )
                     (call %init_peer_id% ("errorHandlingSrv" "error") [%last_error% 5])
                    )
    `
 
export type Create_subResult = [string | null, string[]]
export function create_sub(
    deal_id: string,
    config?: {ttl?: number}
): Promise<Create_subResult>;

export function create_sub(
    peer: IFluenceClient$$,
    deal_id: string,
    config?: {ttl?: number}
): Promise<Create_subResult>;

export function create_sub(...args: any) {


    return callFunction$$(
        args,
        {
    "functionName" : "create_sub",
    "arrow" : {
        "tag" : "arrow",
        "domain" : {
            "tag" : "labeledProduct",
            "fields" : {
                "deal_id" : {
                    "tag" : "scalar",
                    "name" : "string"
                }
            }
        },
        "codomain" : {
            "tag" : "unlabeledProduct",
            "items" : [
                {
                    "tag" : "option",
                    "type" : {
                        "tag" : "scalar",
                        "name" : "string"
                    }
                },
                {
                    "tag" : "array",
                    "type" : {
                        "tag" : "scalar",
                        "name" : "string"
                    }
                }
            ]
        }
    },
    "names" : {
        "relay" : "-relay-",
        "getDataSrv" : "getDataSrv",
        "callbackSrv" : "callbackSrv",
        "responseSrv" : "callbackSrv",
        "responseFnName" : "response",
        "errorHandlingSrv" : "errorHandlingSrv",
        "errorFnName" : "error"
    }
},
        create_sub_script
    )
}

/* eslint-enable */